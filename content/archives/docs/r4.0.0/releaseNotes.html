<!DOCTYPE html>
<!--

    Licensed to the Apache Software Foundation (ASF) under one or more
    contributor license agreements.  See the NOTICE file distributed with
    this work for additional information regarding copyright ownership.
    The ASF licenses this file to You under the Apache License, Version 2.0
    (the "License"); you may not use this file except in compliance with
    the License.  You may obtain a copy of the License at

       http://www.apache.org/licenses/LICENSE- 2.0

    Unless required by applicable law or agreed to in writing, software
    distributed under the License is distributed on an "AS IS" BASIS,
    WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
    See the License for the specific language governing permissions and
    limitations under the License.
-->
<html>
  <head>
    <title>Apache BookKeeper - BookKeeper Documentation</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="/archives/css/bootstrap.min.css" rel="stylesheet">
    <link href="/archives/css/bootstrap-responsive.min.css" rel="stylesheet">
    <link href="/archives/css/styles.css" rel="stylesheet">
  </head>
  <body>
    <header class="navbar navbar-inverse navbar-static-top" role="banner">
      <div class="container">
    	<div class="navbar-header hidden-xs hidden-sm">
    	  <a class="navbar-brand navbar-logo" href="/archives/"><img class="img-responsive" src="/archives/img/bookkeeper_blk40.png" alt="Bookkeeper Logo" /></a>
    	</div>
    	<div class="navbar-header">
    	  <button class="navbar-toggle collapsed" type="button" data-toggle="collapse" data-target=".bs-navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
    	  </button>
    	  <a class="navbar-brand" href="/archives/">Apache BookKeeper</a>
    	</div>
    	<nav class="collapse navbar-collapse bs-navbar-collapse" role="navigation">
    	  <ul class="nav navbar-nav">
    	    <li><a href="/archives/releases.html">Download</a></li>

    	    <li class="dropdown">
    	      <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Documentation<span class="caret"></span></a>
    	      <ul class="dropdown-menu" role="menu">
		<li><a href="/archives/docs/master">Latest (master)</a></li>
		<li><ul>
		    <li><a href="/archives/docs/master/apidocs">Java API docs</a></li>
		    <li><a href="/archives/docs/master/bookkeeperTutorial.html">Tutorial</a></li>
		    <li><a href="/archives/docs/master/bookkeeperConfig.html">Admin guide</a></li>
		</ul><li>
                <li><a href="/archives/docs/r4.4.0">Release 4.4.0</a></li>
                <li class="divider"></li>
                <li>Older releases</li>
                <li><a href="/archives/docs/r4.3.2">Release 4.3.2</a></li>
                <li><a href="/archives/docs/r4.3.1">Release 4.3.1</a></li>
                <li><a href="/archives/docs/r4.3.0">Release 4.3.0</a></li>
                <li><a href="/archives/docs/r4.2.4">Release 4.2.4</a></li>
                <li><a href="/archives/docs/r4.2.3">Release 4.2.3</a></li>
                <li><a href="/archives/docs/r4.2.2">Release 4.2.2</a></li>
                <li><a href="/archives/docs/r4.2.1">Release 4.2.1</a></li>
                <li><a href="/archives/docs/r4.2.0">Release 4.2.0</a></li>
                <li><a href="/archives/docs/r4.1.0">Release 4.1.0</a></li>
                <li><a href="/archives/docs/r4.0.0">Release 4.0.0</a></li>
              </ul>
            </li>
            
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Get Involved<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/archives/lists.html">Mailing Lists</a></li>
                <li><a href="/archives/irc.html">IRC</a></li>
                <li><a href="/archives/svn.html">Version Control</a></li>
                <li><a href="https://issues.apache.org/jira/browse/BOOKKEEPER">Issue Tracker</a></li>
              </ul>
            </li>

            <li><a href="https://cwiki.apache.org/confluence/display/BOOKKEEPER/Index">Wiki</a></li>
            <!--<li><a href="#">Hedwig</a></li>//-->
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">Project Info<span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/archives/credits.html">Who are we?</a></li>
                <li><a href="/archives/bylaws.html">Bylaws</a></li>
                <li><a href="http://www.apache.org/licenses/">License</a></li>
                <li class="divider"></li>
                <li><a href="/archives/privacy.html">Privacy Policy</a></li>
                <li><a href="http://www.apache.org/foundation/sponsorship.html">Sponsership</a></li>
                <li><a href="http://www.apache.org/foundation/thanks.html">Thanks</a></li>
              </ul>
            </li>
          </ul>
          <script>
            (function() {
            var cx = '017580107654524087317:iqnsyimpydg';
            var gcse = document.createElement('script');
            gcse.type = 'text/javascript';
            gcse.async = true;
            gcse.src = (document.location.protocol == 'https:' ? 'https:' : 'http:') +
            '//www.google.com/cse/cse.js?cx=' + cx;
            var s = document.getElementsByTagName('script')[0];
            s.parentNode.insertBefore(gcse, s);
            })();
          </script>
          
          <div class="navbar-form navbar-right visible-lg" id="googlebox">
            <gcse:searchbox-only></gcse:searchbox-only>
          </div>
        </nav>
      </div>
    </header>
    <div class="container">

 <h1>Release Notes - Bookkeeper - Version 4.0.0</h1>
    <br />
<h2>        Sub-task
</h2>
<ul>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-109'><span class="caps">BOOKKEEPER</span>-109</a>] -         Add documentation to describe how bookies flushes data
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-111'><span class="caps">BOOKKEEPER</span>-111</a>] -         Document bookie recovery feature
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-120'><span class="caps">BOOKKEEPER</span>-120</a>] -         Review BookKeeper client documentation
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-121'><span class="caps">BOOKKEEPER</span>-121</a>] -         Review Hedwig client documentation
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-122'><span class="caps">BOOKKEEPER</span>-122</a>] -         Review BookKeeper server documentation
</li>
</ul>
            <br />
<h2>        Bug
</h2>
<ul>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-1'><span class="caps">BOOKKEEPER</span>-1</a>] -         Static variable makes tests fail
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-5'><span class="caps">BOOKKEEPER</span>-5</a>] -         Issue with Netty in BookKeeper
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-18'><span class="caps">BOOKKEEPER</span>-18</a>] -         maven build is unstable
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-19'><span class="caps">BOOKKEEPER</span>-19</a>] -         BookKeeper doesn&#39;t support more than 2Gig of memory
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-22'><span class="caps">BOOKKEEPER</span>-22</a>] -         Exception in LedgerCache causes addEntry request to fail
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-27'><span class="caps">BOOKKEEPER</span>-27</a>] -         mvn site failed with unresolved dependencies
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-28'><span class="caps">BOOKKEEPER</span>-28</a>] -         Create useful startup scripts for bookkeeper and hedwig
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-29'><span class="caps">BOOKKEEPER</span>-29</a>] -         BookieRecoveryTest fails intermittently
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-38'><span class="caps">BOOKKEEPER</span>-38</a>] -         Bookie Server doesn&#39;t exit when its zookeeper session is expired. So the process is hang there.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-39'><span class="caps">BOOKKEEPER</span>-39</a>] -         Bookie server failed to restart because of too many ledgers (more than ~50,000 ledgers)
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-43'><span class="caps">BOOKKEEPER</span>-43</a>] -         NullPointException when releasing topic
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-50'><span class="caps">BOOKKEEPER</span>-50</a>] -         NullPointException at LedgerDescriptor#cmpMasterKey
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-51'><span class="caps">BOOKKEEPER</span>-51</a>] -         NullPointException at <span class="caps">FIFOD</span>eliveryManager#deliveryPtrs
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-52'><span class="caps">BOOKKEEPER</span>-52</a>] -         Message sequence confuse due to the subscribeMsgQueue@SubscribeResponseHandler
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-53'><span class="caps">BOOKKEEPER</span>-53</a>] -         race condition of  outstandingMsgSet@SubscribeResponseHandler 
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-57'><span class="caps">BOOKKEEPER</span>-57</a>] -         NullPointException at bookie.zk@EntryLogger
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-58'><span class="caps">BOOKKEEPER</span>-58</a>] -         Changes introduced in BK-38 cause BookieClientTest to hang indefinitely.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-59'><span class="caps">BOOKKEEPER</span>-59</a>] -         Race condition in netty code allocates and orphans resources (BK-5 revisited)
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-61'><span class="caps">BOOKKEEPER</span>-61</a>] -         BufferedChannel read endless when the remaining bytes of file is less than the capacity of read buffer
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-62'><span class="caps">BOOKKEEPER</span>-62</a>] -         Bookie can not start when encountering corrupted records
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-63'><span class="caps">BOOKKEEPER</span>-63</a>] -         Hedwig PubSubServer must wait for its Zookeeper client to be connected upon startup
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-65'><span class="caps">BOOKKEEPER</span>-65</a>] -         fix dependencies on incompatible versions of netty
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-66'><span class="caps">BOOKKEEPER</span>-66</a>] -         use IPv4 for builds
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-68'><span class="caps">BOOKKEEPER</span>-68</a>] -         Conditional setData
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-69'><span class="caps">BOOKKEEPER</span>-69</a>] -         ServerRedirectLoopException when a machine (hosts bookie server &amp; hub server) reboot, which is caused by race condition of topic manager
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-71'><span class="caps">BOOKKEEPER</span>-71</a>] -         hedwig c++ client does not build. 
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-79'><span class="caps">BOOKKEEPER</span>-79</a>] -         randomly startDelivery/stopDelivery will core dump in c++ hedwig client
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-80'><span class="caps">BOOKKEEPER</span>-80</a>] -         subscription msg queue race condition in hedwig c++ client
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-81'><span class="caps">BOOKKEEPER</span>-81</a>] -         disk space of garbage collected entry logger files isn&#39;t reclaimed util process quit 
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-86'><span class="caps">BOOKKEEPER</span>-86</a>] -         bookkeeper-benchmark fails to compile after <span class="caps">BOOKKEEPER</span>-68
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-87'><span class="caps">BOOKKEEPER</span>-87</a>] -         TestHedwigHub exhausts direct buffer memory with netty 3.2.4.Final
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-88'><span class="caps">BOOKKEEPER</span>-88</a>] -         derby doesn&#39;t like - in the topic names
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-92'><span class="caps">BOOKKEEPER</span>-92</a>] -         using wrong context object in readLastConfirmedComplete callback
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-93'><span class="caps">BOOKKEEPER</span>-93</a>] -         bookkeeper doesn&#39;t work correctly on OpenLedgerNoRecovery
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-94'><span class="caps">BOOKKEEPER</span>-94</a>] -         Double callbacks in readLastConfirmedOp which fails readLastConfirmed operation even received enough valid responses.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-100'><span class="caps">BOOKKEEPER</span>-100</a>] -         Some hedwig tests have build errors
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-103'><span class="caps">BOOKKEEPER</span>-103</a>] -         ledgerId and entryId is parsed wrong when addEntry
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-106'><span class="caps">BOOKKEEPER</span>-106</a>] -         recoveryBookieData can select a recovery bookie which is already in the ledgers ensemble
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-107'><span class="caps">BOOKKEEPER</span>-107</a>] -         memory leak in HostAddress of hedwig c++ client
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-115'><span class="caps">BOOKKEEPER</span>-115</a>] -         LocalBookKeeper fails after <span class="caps">BOOKKEEPER</span>-108
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-118'><span class="caps">BOOKKEEPER</span>-118</a>] -         Hedwig client doesn&#39;t kill and remove old subscription channel after redirection.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-119'><span class="caps">BOOKKEEPER</span>-119</a>] -         Keys in configuration have inconsistent style
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-124'><span class="caps">BOOKKEEPER</span>-124</a>] -         build has <span class="caps">RAT </span>failures
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-125'><span class="caps">BOOKKEEPER</span>-125</a>] -         log4j still used in some places
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-127'><span class="caps">BOOKKEEPER</span>-127</a>] -         Make poms use official zookeeper 3.4.0
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-128'><span class="caps">BOOKKEEPER</span>-128</a>] -         pom and script modifications required for generating release packages
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-129'><span class="caps">BOOKKEEPER</span>-129</a>] -         ZK_TIMEOUT typo in client/server configuration
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-131'><span class="caps">BOOKKEEPER</span>-131</a>] -         Fix zookeeper test dependency
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-134'><span class="caps">BOOKKEEPER</span>-134</a>] -         Delete superfluous lib directories
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-138'><span class="caps">BOOKKEEPER</span>-138</a>] -         <span class="caps">NOTICE.</span>txt is invalid
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-139'><span class="caps">BOOKKEEPER</span>-139</a>] -         Binary packages do not carry <span class="caps">NOTICE.</span>txt
</li>
</ul>
            <br />
<h2>        Improvement
</h2>
<ul>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-26'><span class="caps">BOOKKEEPER</span>-26</a>] -         Indentation is all messed up in the BookKeeper code
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-30'><span class="caps">BOOKKEEPER</span>-30</a>] -         Test are too noisy
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-33'><span class="caps">BOOKKEEPER</span>-33</a>] -         Add length and offset parameter to addEntry
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-41'><span class="caps">BOOKKEEPER</span>-41</a>] -         Generation of packages for distribution.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-44'><span class="caps">BOOKKEEPER</span>-44</a>] -         Reuse publish channel to default server to avoid too many connect requests to default server when lots of producers came in same time
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-82'><span class="caps">BOOKKEEPER</span>-82</a>] -         support journal rolling
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-83'><span class="caps">BOOKKEEPER</span>-83</a>] -         Added versioning and flags to the bookie protocol
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-84'><span class="caps">BOOKKEEPER</span>-84</a>] -         Add versioning for ZK metadata
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-89'><span class="caps">BOOKKEEPER</span>-89</a>] -         Bookkeeper <span class="caps">API </span>changes for initial Bookkeeper release
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-90'><span class="caps">BOOKKEEPER</span>-90</a>] -         Hedwig <span class="caps">API </span>changes for initial Bookkeeper release
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-91'><span class="caps">BOOKKEEPER</span>-91</a>] -         Bookkeeper and hedwig clients should not use log4j directly
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-102'><span class="caps">BOOKKEEPER</span>-102</a>] -         Make bookkeeper use ZK from temporary repo
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-104'><span class="caps">BOOKKEEPER</span>-104</a>] -         Add versioning between bookie and its filesystem layout
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-108'><span class="caps">BOOKKEEPER</span>-108</a>] -         add configuration support for BK
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-114'><span class="caps">BOOKKEEPER</span>-114</a>] -         add a shutdown hook to shut down bookie server safely.
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-117'><span class="caps">BOOKKEEPER</span>-117</a>] -         Support multi threads in hedwig cpp client to leverage multi-core hardware
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-132'><span class="caps">BOOKKEEPER</span>-132</a>] -         Sign artifacts before deploying to maven
</li>
</ul>
    <br />
<h2>        New Feature
</h2>
<ul>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-11'><span class="caps">BOOKKEEPER</span>-11</a>] -         Read from open ledger
</li>
<li>[<a href='https://issues.apache.org/jira/browse/BOOKKEEPER-101'><span class="caps">BOOKKEEPER</span>-101</a>] -         Add Fencing to Bookkeeper
</li>
</ul>
                                            

    </div>
    <footer class="footer">
      <div class="container">
        <p class="text-muted">Copyright &copy; 2014 The Apache Software Foundation, Licensed under the Apache License, Version 2.0.<br/>
	Apache BookKeeper, BookKeeper, Apache, Apache ZooKeeper, ZooKeeper, the Apache feather logo, and the Apache BookKeeper project logo are trademarks of The Apache Software Foundation.</p>
      </div>
    </footer>

    <script src="//code.jquery.com/jquery.js"></script>
    <script src="/archives/js/bootstrap.min.js"></script>
  </body>
</html>
