<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>LongZkLedgerIdGenerator (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../jquery/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="LongZkLedgerIdGenerator (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":10,"i3":10};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LongZkLedgerIdGenerator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.apache.bookkeeper.meta</a></div>
<h2 title="Class LongZkLedgerIdGenerator" class="title">Class LongZkLedgerIdGenerator</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.bookkeeper.meta.LongZkLedgerIdGenerator</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code>java.io.Closeable</code>, <code>java.lang.AutoCloseable</code>, <code><a href="LedgerIdGenerator.html" title="interface in org.apache.bookkeeper.meta">LedgerIdGenerator</a></code></dd>
</dl>
<hr>
<pre>public class <span class="typeNameLabel">LongZkLedgerIdGenerator</span>
extends java.lang.Object
implements <a href="LedgerIdGenerator.html" title="interface in org.apache.bookkeeper.meta">LedgerIdGenerator</a></pre>
<div class="block">ZooKeeper based ledger id generator class, which using EPHEMERAL_SEQUENTIAL
 with <i>(ledgerIdGenPath)/HOB-[high-32-bits]/ID-</i> prefix to generate ledger id. Note
 zookeeper sequential counter has a format of %10d -- that is 10 digits with 0
 (zero) padding, i.e. "&lt;path&gt;0000000001", so ledger id space would be
 fundamentally limited to 9 billion. In practice, the id generated by zookeeper
 is only 31 bits (signed 32-bit integer), so the limit is much lower than 9 billion.

 <p>In order to support the full range of the long ledgerId, once ledgerIds reach Integer.MAX_INT,
 a new system is employed. The 32 most significant bits of the ledger ID are taken and turned into
 a directory prefixed with <i>HOB-</i> under <i>(ledgerIdGenPath)</i>

 <p>Under this <i>HOB-</i> directory, zookeeper is used to continue generating EPHEMERAL_SEQUENTIAL ids
 which constitute the lower 32-bits of the ledgerId (sign bit is always 0). Once the <i>HOB-</i> directory runs out
 of available ids, the process is repeated. The higher bits are incremented, a new <i>HOB-</i> directory is created,
 and zookeeper generates sequential ids underneath it.

 <p>The reason for treating ids which are less than Integer.MAX_INT differently is to maintain backwards
 compatibility. This is a drop-in replacement for ZkLedgerIdGenerator.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(org.apache.zookeeper.ZooKeeper,java.lang.String,java.lang.String,org.apache.bookkeeper.meta.ZkLedgerIdGenerator,java.util.List)">LongZkLedgerIdGenerator</a></span>&#8203;(org.apache.zookeeper.ZooKeeper&nbsp;zk,
                       java.lang.String&nbsp;ledgersPath,
                       java.lang.String&nbsp;idGenZnodeName,
                       <a href="ZkLedgerIdGenerator.html" title="class in org.apache.bookkeeper.meta">ZkLedgerIdGenerator</a>&nbsp;shortIdGen,
                       java.util.List&lt;org.apache.zookeeper.data.ACL&gt;&nbsp;zkAcls)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#close()">close</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#generateLedgerId(org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback)">generateLedgerId</a></span>&#8203;(<a href="../proto/BookkeeperInternalCallbacks.GenericCallback.html" title="interface in org.apache.bookkeeper.proto">BookkeeperInternalCallbacks.GenericCallback</a>&lt;java.lang.Long&gt;&nbsp;cb)</code></th>
<td class="colLast">
<div class="block">Generate a global unique ledger id.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#invalidateLedgerIdGenPathStatus()">invalidateLedgerIdGenPathStatus</a></span>()</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#ledgerIdGenPathPresent(org.apache.zookeeper.ZooKeeper)">ledgerIdGenPathPresent</a></span>&#8203;(org.apache.zookeeper.ZooKeeper&nbsp;zk)</code></th>
<td class="colLast">
<div class="block">Checks the existence of the long ledger id gen path.</div>
</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(org.apache.zookeeper.ZooKeeper,java.lang.String,java.lang.String,org.apache.bookkeeper.meta.ZkLedgerIdGenerator,java.util.List)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>LongZkLedgerIdGenerator</h4>
<pre>public&nbsp;LongZkLedgerIdGenerator&#8203;(org.apache.zookeeper.ZooKeeper&nbsp;zk,
                               java.lang.String&nbsp;ledgersPath,
                               java.lang.String&nbsp;idGenZnodeName,
                               <a href="ZkLedgerIdGenerator.html" title="class in org.apache.bookkeeper.meta">ZkLedgerIdGenerator</a>&nbsp;shortIdGen,
                               java.util.List&lt;org.apache.zookeeper.data.ACL&gt;&nbsp;zkAcls)</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="invalidateLedgerIdGenPathStatus()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>invalidateLedgerIdGenPathStatus</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;invalidateLedgerIdGenPathStatus()</pre>
</li>
</ul>
<a id="ledgerIdGenPathPresent(org.apache.zookeeper.ZooKeeper)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>ledgerIdGenPathPresent</h4>
<pre class="methodSignature">public&nbsp;boolean&nbsp;ledgerIdGenPathPresent&#8203;(org.apache.zookeeper.ZooKeeper&nbsp;zk)
                               throws org.apache.zookeeper.KeeperException,
                                      java.lang.InterruptedException</pre>
<div class="block">Checks the existence of the long ledger id gen path. Existence indicates we have switched from the legacy
 algorithm to the new method of generating 63-bit ids. If the existence is UNKNOWN, it looks in zk to
 find out. If it previously checked in zk, it returns that value. This value changes when we run out
 of ids < Integer.MAX_VALUE, and try to create the long ledger id gen path.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>zk</code> - </dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>Does the long ledger id gen path exist?</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>org.apache.zookeeper.KeeperException</code></dd>
<dd><code>java.lang.InterruptedException</code></dd>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><code>createLongLedgerIdPathAndGenerateLongLedgerId(org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback&lt;java.lang.Long&gt;,java.lang.String)</code></dd>
</dl>
</li>
</ul>
<a id="generateLedgerId(org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>generateLedgerId</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;generateLedgerId&#8203;(<a href="../proto/BookkeeperInternalCallbacks.GenericCallback.html" title="interface in org.apache.bookkeeper.proto">BookkeeperInternalCallbacks.GenericCallback</a>&lt;java.lang.Long&gt;&nbsp;cb)</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="LedgerIdGenerator.html#generateLedgerId(org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback)">LedgerIdGenerator</a></code></span></div>
<div class="block">Generate a global unique ledger id.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="LedgerIdGenerator.html#generateLedgerId(org.apache.bookkeeper.proto.BookkeeperInternalCallbacks.GenericCallback)">generateLedgerId</a></code>&nbsp;in interface&nbsp;<code><a href="LedgerIdGenerator.html" title="interface in org.apache.bookkeeper.meta">LedgerIdGenerator</a></code></dd>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>cb</code> - Callback when a new ledger id is generated, return code:<ul>
            <li><code>BKException.Code.OK</code> if success</li>
            <li><code>BKException.Code.ZKException</code> when can't generate new ledger id</li>
            </ul></dd>
</dl>
</li>
</ul>
<a id="close()">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>close</h4>
<pre class="methodSignature">public&nbsp;void&nbsp;close()
           throws java.io.IOException</pre>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>close</code>&nbsp;in interface&nbsp;<code>java.lang.AutoCloseable</code></dd>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code>close</code>&nbsp;in interface&nbsp;<code>java.io.Closeable</code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/LongZkLedgerIdGenerator.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li>Nested&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2011&#x2013;2023 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</body>
</html>
