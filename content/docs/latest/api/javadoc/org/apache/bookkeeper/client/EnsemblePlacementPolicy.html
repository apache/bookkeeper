<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>EnsemblePlacementPolicy (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../script.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../jquery/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="EnsemblePlacementPolicy (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":18,"i1":18,"i2":6,"i3":18,"i4":6,"i5":6,"i6":6,"i7":6,"i8":6,"i9":6,"i10":18,"i11":6,"i12":18};
var tabs = {65535:["t0","All Methods"],2:["t2","Instance Methods"],4:["t3","Abstract Methods"],16:["t5","Default Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/EnsemblePlacementPolicy.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.apache.bookkeeper.client</a></div>
<h2 title="Interface EnsemblePlacementPolicy" class="title">Interface EnsemblePlacementPolicy</h2>
</div>
<div class="contentContainer">
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Known Subinterfaces:</dt>
<dd><code><a href="ITopologyAwareEnsemblePlacementPolicy.html" title="interface in org.apache.bookkeeper.client">ITopologyAwareEnsemblePlacementPolicy</a>&lt;T&gt;</code></dd>
</dl>
<dl>
<dt>All Known Implementing Classes:</dt>
<dd><code><a href="DefaultEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client">DefaultEnsemblePlacementPolicy</a></code>, <code><a href="../bookie/LocalBookieEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.bookie">LocalBookieEnsemblePlacementPolicy</a></code>, <code><a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client">RackawareEnsemblePlacementPolicy</a></code>, <code><a href="RackawareEnsemblePlacementPolicyImpl.html" title="class in org.apache.bookkeeper.client">RackawareEnsemblePlacementPolicyImpl</a></code>, <code><a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client">RegionAwareEnsemblePlacementPolicy</a></code>, <code><a href="TopologyAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client">TopologyAwareEnsemblePlacementPolicy</a></code>, <code><a href="ZoneawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client">ZoneawareEnsemblePlacementPolicy</a></code>, <code><a href="ZoneawareEnsemblePlacementPolicyImpl.html" title="class in org.apache.bookkeeper.client">ZoneawareEnsemblePlacementPolicyImpl</a></code></dd>
</dl>
<hr>
<pre><a href="../common/annotation/InterfaceAudience.Public.html" title="annotation in org.apache.bookkeeper.common.annotation">@Public</a>
<a href="../common/annotation/InterfaceStability.Evolving.html" title="annotation in org.apache.bookkeeper.common.annotation">@Evolving</a>
public interface <span class="typeNameLabel">EnsemblePlacementPolicy</span></pre>
<div class="block"><a href="EnsemblePlacementPolicy.html" title="interface in org.apache.bookkeeper.client"><code>EnsemblePlacementPolicy</code></a> encapsulates the algorithm that bookkeeper client uses to select a number of bookies
 from the cluster as an ensemble for storing entries.

 <p>The algorithm is typically implemented based on the data input as well as the network topology properties.

 <h2>How does it work?</h2>

 <p>This interface basically covers three parts:</p>
 <ul>
 <li>Initialization and uninitialization</li>
 <li>How to choose bookies to place data</li>
 <li>How to choose bookies to do speculative reads</li>
 </ul>

 <h3>Initialization and uninitialization</h3>

 <p>The ensemble placement policy is constructed by jvm reflection during constructing bookkeeper client.
 After the <code>EnsemblePlacementPolicy</code> is constructed, bookkeeper client will call
 <a href="#initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger,org.apache.bookkeeper.proto.BookieAddressResolver)"><code>initialize(ClientConfiguration, Optional, HashedWheelTimer, FeatureProvider, StatsLogger,
 BookieAddressResolver)</code></a> to initialize the placement policy.

 <p>The <a href="#initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger,org.apache.bookkeeper.proto.BookieAddressResolver)"><code>initialize(ClientConfiguration, Optional, HashedWheelTimer, FeatureProvider, StatsLogger,
 BookieAddressResolver)</code></a> method takes a few resources from bookkeeper for instantiating itself.
 These resources include:

 <ul>
 <li>`ClientConfiguration` : The client configuration that used for constructing the bookkeeper client.
                             The implementation of the placement policy could obtain its settings from this
                             configuration.
 <li>`DNSToSwitchMapping`: The DNS resolver for the ensemble policy to build the network topology of the bookies
                           cluster. It is optional.
 <li>`HashedWheelTimer`: A hashed wheel timer that could be used for timing related work.
                         For example, a stabilize network topology could use it to delay network topology changes to
                         reduce impacts of flapping bookie registrations due to zk session expires.
 <li>`FeatureProvider`: A <a href="../feature/FeatureProvider.html" title="interface in org.apache.bookkeeper.feature"><code>FeatureProvider</code></a> that the policy could use for enabling or disabling its offered
                        features. For example, a <a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a> could offer features
                        to disable placing data to a specific region at runtime.
 <li>`StatsLogger`: A <a href="../stats/StatsLogger.html" title="interface in org.apache.bookkeeper.stats"><code>StatsLogger</code></a> for exposing stats.
 </ul>

 <p>The ensemble placement policy is a single instance per bookkeeper client. The instance will
 be <a href="#uninitalize()"><code>uninitalize()</code></a> when closing the bookkeeper client. The implementation of a placement policy should be
 responsible for releasing all the resources that allocated during
 <a href="#initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger,org.apache.bookkeeper.proto.BookieAddressResolver)"><code>initialize(ClientConfiguration, Optional, HashedWheelTimer, FeatureProvider, StatsLogger,
 BookieAddressResolver)</code></a>.

 <h3>How to choose bookies to place data</h3>

 <p>The bookkeeper client discovers list of bookies from zookeeper via <code>BookieWatcher</code> - whenever there are
 bookie changes, the ensemble placement policy will be notified with new list of bookies via
 <a href="#onClusterChanged(java.util.Set,java.util.Set)"><code>onClusterChanged(Set, Set)</code></a>. The implementation of the ensemble placement policy will react on those
 changes to build new network topology. Subsequent operations like <a href="#newEnsemble(int,int,int,java.util.Map,java.util.Set)"><code>newEnsemble(int, int, int, Map, Set)</code></a> or
 <a href="#replaceBookie(int,int,int,java.util.Map,java.util.List,org.apache.bookkeeper.net.BookieId,java.util.Set)"><code>replaceBookie(int, int, int, java.util.Map, java.util.List, BookieId, java.util.Set)</code></a>
 hence can operate on the new
 network topology.

 <p>Both <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a> and <a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a> are
 <a href="TopologyAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>TopologyAwareEnsemblePlacementPolicy</code></a>s. They build a <a href="../net/NetworkTopology.html" title="interface in org.apache.bookkeeper.net"><code>NetworkTopology</code></a> on
 bookie changes, use it for ensemble placement and ensure <code>rack/region</code> coverage for write quorums.

 <h4>Network Topology</h4>

 <p>The network topology is presenting a cluster of bookies in a tree hierarchical structure. For example,
 a bookie cluster may be consists of many data centers (aka regions) filled with racks of machines.
 In this tree structure, leaves represent bookies and inner nodes represent switches/routes that manage
 traffic in/out of regions or racks.

 <p>For example, there are 3 bookies in region `A`. They are `bk1`, `bk2` and `bk3`. And their network locations are
 <code>/region-a/rack-1/bk1</code>, <code>/region-a/rack-1/bk2</code> and <code>/region-a/rack-2/bk3</code>. So the network topology
 will look like below:

 <pre>
      root
        |
     region-a
       /  \
 rack-1  rack-2
   /  \       \
 bk1  bk2     bk3
 </pre>

 <p>Another example, there are 4 bookies spanning in two regions `A` and `B`. They are `bk1`, `bk2`, `bk3` and `bk4`.
 And their network locations are <code>/region-a/rack-1/bk1</code>, <code>/region-a/rack-1/bk2</code>,
 <code>/region-b/rack-2/bk3</code> and <code>/region-b/rack-2/bk4</code>. The network topology will look like below:

 <pre>
         root
         /  \
 region-a  region-b
     |         |
   rack-1    rack-2
     / \       / \
   bk1  bk2  bk3  bk4
 </pre>

 <p>The network location of each bookie is resolved by a <a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net"><code>DNSToSwitchMapping</code></a>. The <a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net"><code>DNSToSwitchMapping</code></a>
 resolves a list of DNS-names or IP-addresses into a list of network locations. The network location that is returned
 must be a network path of the form `/region/rack`, where `/` is the root, and `region` is the region id representing
 the data center where `rack` is located. The network topology of the bookie cluster would determine the number of

 <h4>RackAware and RegionAware</h4>

 <p><a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a> basically just chooses bookies from different racks in the built
 network topology. It guarantees that a write quorum will cover at least two racks. It expects the network locations
 resolved by <a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net"><code>DNSToSwitchMapping</code></a> have at least 2 levels. For example, network location paths like
 <code>/dc1/rack0</code> and <code>/dc1/row1/rack0</code> are okay, but <code>/rack0</code> is not acceptable.

 <p><a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a> is a hierarchical placement policy, which it chooses
 equal-sized bookies from regions, and within each region it uses <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a> to choose
 bookies from racks. For example, if there is 3 regions - <code>region-a</code>, <code>region-b</code> and <code>region-c</code>,
 an application want to allocate a <code>15-bookies</code> ensemble. First, it would figure out there are 3 regions and
 it should allocate 5 bookies from each region. Second, for each region, it would use
 <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a> to choose <i>5</i> bookies.

 <p>Since <a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a> is based on <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a>, it expects
 the network locations resolved by <a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net"><code>DNSToSwitchMapping</code></a> have at least <b>3</b> levels.

 <h3>How to choose bookies to do speculative reads?</h3>

 <p><a href="#reorderReadSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)"><code>reorderReadSequence(List, BookiesHealthInfo, WriteSet)</code></a> and
 <a href="#reorderReadLACSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)"><code>reorderReadLACSequence(List, BookiesHealthInfo, WriteSet)</code></a> are
 two methods exposed by the placement policy, to help client determine a better read sequence according to the
 network topology and the bookie failure history.

 <p>For example, in <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a>, the reads will be attempted in following sequence:

 <ul>
 <li>bookies are writable and didn't experience failures before
 <li>bookies are writable and experienced failures before
 <li>bookies are readonly
 <li>bookies already disappeared from network topology
 </ul>

 <p>In <a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a>, the reads will be tried in similar following sequence
 as `RackAware` placement policy. There is a slight different on trying writable bookies: after trying every 2
 bookies from local region, it would try a bookie from remote region. Hence it would achieve low latency even
 there is network issues within local region.

 <h2>How to configure the placement policy?</h2>

 <p>Currently there are 3 implementations available by default. They are:
 <ul>
     <li><a href="DefaultEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>DefaultEnsemblePlacementPolicy</code></a></li>
     <li><a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a></li>
     <li><a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a></li>
 </ul>

 <p>You can configure the ensemble policy by specifying the placement policy class in
 <a href="../conf/ClientConfiguration.html#setEnsemblePlacementPolicy(java.lang.Class)"><code>ClientConfiguration.setEnsemblePlacementPolicy(Class)</code></a>.

 <p><a href="DefaultEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>DefaultEnsemblePlacementPolicy</code></a> randomly pickups bookies from the cluster, while both
 <a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a> and <a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a> choose bookies based on
 network locations. So you might also consider configuring a proper <a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net"><code>DNSToSwitchMapping</code></a> in
 <a href="BookKeeper.Builder.html" title="class in org.apache.bookkeeper.client"><code>BookKeeper.Builder</code></a> to resolve the correct network locations for your cluster.</div>
<dl>
<dt><span class="seeLabel">See Also:</span></dt>
<dd><a href="TopologyAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>TopologyAwareEnsemblePlacementPolicy</code></a>, 
<a href="DefaultEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>DefaultEnsemblePlacementPolicy</code></a>, 
<a href="RackawareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RackawareEnsemblePlacementPolicy</code></a>, 
<a href="RegionAwareEnsemblePlacementPolicy.html" title="class in org.apache.bookkeeper.client"><code>RegionAwareEnsemblePlacementPolicy</code></a></dd>
</dl>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Interface</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="EnsemblePlacementPolicy.PlacementPolicyAdherence.html" title="enum in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementPolicyAdherence</a></span></code></th>
<td class="colLast">
<div class="block">enum for PlacementPolicyAdherence.</div>
</td>
</tr>
<tr class="rowColor">
<td class="colFirst"><code>static class&nbsp;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;<a href="EnsemblePlacementPolicy.PlacementResult.html" title="type parameter in EnsemblePlacementPolicy.PlacementResult">T</a>&gt;</span></code></th>
<td class="colLast">
<div class="block">Result of a placement calculation against a placement policy.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t3" class="tableTab"><span><a href="javascript:show(4);">Abstract Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t5" class="tableTab"><span><a href="javascript:show(16);">Default Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>default boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#areAckedBookiesAdheringToPlacementPolicy(java.util.Set,int,int)">areAckedBookiesAdheringToPlacementPolicy</a></span>&#8203;(java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ackedBookies,
                                        int&nbsp;writeQuorumSize,
                                        int&nbsp;ackQuorumSize)</code></th>
<td class="colLast">
<div class="block">Returns true if the bookies that have acknowledged a write adhere to the minimum fault domains as defined in the
 placement policy in use.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>default int</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getStickyReadBookieIndex(org.apache.bookkeeper.client.api.LedgerMetadata,java.util.Optional)">getStickyReadBookieIndex</a></span>&#8203;(<a href="api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                        java.util.Optional&lt;java.lang.Integer&gt;&nbsp;currentStickyBookieIndex)</code></th>
<td class="colLast">
<div class="block">Select one bookie to the "sticky" bookie where all reads for a particular
 ledger will be directed to.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code><a href="EnsemblePlacementPolicy.html" title="interface in org.apache.bookkeeper.client">EnsemblePlacementPolicy</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger,org.apache.bookkeeper.proto.BookieAddressResolver)">initialize</a></span>&#8203;(<a href="../conf/ClientConfiguration.html" title="class in org.apache.bookkeeper.conf">ClientConfiguration</a>&nbsp;conf,
          java.util.Optional&lt;<a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net">DNSToSwitchMapping</a>&gt;&nbsp;optionalDnsResolver,
          io.netty.util.HashedWheelTimer&nbsp;hashedWheelTimer,
          <a href="../feature/FeatureProvider.html" title="interface in org.apache.bookkeeper.feature">FeatureProvider</a>&nbsp;featureProvider,
          <a href="../stats/StatsLogger.html" title="interface in org.apache.bookkeeper.stats">StatsLogger</a>&nbsp;statsLogger,
          <a href="../proto/BookieAddressResolver.html" title="interface in org.apache.bookkeeper.proto">BookieAddressResolver</a>&nbsp;bookieAddressResolver)</code></th>
<td class="colLast">
<div class="block">Initialize the policy.</div>
</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>default <a href="EnsemblePlacementPolicy.PlacementPolicyAdherence.html" title="enum in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementPolicyAdherence</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isEnsembleAdheringToPlacementPolicy(java.util.List,int,int)">isEnsembleAdheringToPlacementPolicy</a></span>&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensembleList,
                                   int&nbsp;writeQuorumSize,
                                   int&nbsp;ackQuorumSize)</code></th>
<td class="colLast">
<div class="block">returns AdherenceLevel if the Ensemble is strictly/softly/fails adhering
 to placement policy, like in the case of
 RackawareEnsemblePlacementPolicy, bookies in the writeset are from
 'minNumRacksPerWriteQuorum' number of racks.</div>
</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code><a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#newEnsemble(int,int,int,java.util.Map,java.util.Set)">newEnsemble</a></span>&#8203;(int&nbsp;ensembleSize,
           int&nbsp;writeQuorumSize,
           int&nbsp;ackQuorumSize,
           java.util.Map&lt;java.lang.String,&#8203;byte[]&gt;&nbsp;customMetadata,
           java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies)</code></th>
<td class="colLast">
<div class="block">Choose <i>numBookies</i> bookies for ensemble.</div>
</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#onClusterChanged(java.util.Set,java.util.Set)">onClusterChanged</a></span>&#8203;(java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;writableBookies,
                java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;readOnlyBookies)</code></th>
<td class="colLast">
<div class="block">A consistent view of the cluster (what bookies are available as writable, what bookies are available as
 readonly) is updated when any changes happen in the cluster.</div>
</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#registerSlowBookie(org.apache.bookkeeper.net.BookieId,long)">registerSlowBookie</a></span>&#8203;(<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieSocketAddress,
                  long&nbsp;entryId)</code></th>
<td class="colLast">
<div class="block">Register a bookie as slow so that it is tried after available and read-only bookies.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code><a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#reorderReadLACSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)">reorderReadLACSequence</a></span>&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensemble,
                      <a href="BookiesHealthInfo.html" title="interface in org.apache.bookkeeper.client">BookiesHealthInfo</a>&nbsp;bookiesHealthInfo,
                      <a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;writeSet)</code></th>
<td class="colLast">
<div class="block">Reorder the read last add confirmed sequence of a given write quorum <i>writeSet</i>.</div>
</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code><a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a></code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#reorderReadSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)">reorderReadSequence</a></span>&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensemble,
                   <a href="BookiesHealthInfo.html" title="interface in org.apache.bookkeeper.client">BookiesHealthInfo</a>&nbsp;bookiesHealthInfo,
                   <a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;writeSet)</code></th>
<td class="colLast">
<div class="block">Reorder the read sequence of a given write quorum <i>writeSet</i>.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code><a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#replaceBookie(int,int,int,java.util.Map,java.util.List,org.apache.bookkeeper.net.BookieId,java.util.Set)">replaceBookie</a></span>&#8203;(int&nbsp;ensembleSize,
             int&nbsp;writeQuorumSize,
             int&nbsp;ackQuorumSize,
             java.util.Map&lt;java.lang.String,&#8203;byte[]&gt;&nbsp;customMetadata,
             java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;currentEnsemble,
             <a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieToReplace,
             java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies)</code></th>
<td class="colLast">
<div class="block">Choose a new bookie to replace <i>bookieToReplace</i>.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>default <a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#replaceToAdherePlacementPolicy(int,int,int,java.util.Set,java.util.List)">replaceToAdherePlacementPolicy</a></span>&#8203;(int&nbsp;ensembleSize,
                              int&nbsp;writeQuorumSize,
                              int&nbsp;ackQuorumSize,
                              java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies,
                              java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;currentEnsemble)</code></th>
<td class="colLast">
<div class="block">Returns placement result.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#uninitalize()">uninitalize</a></span>()</code></th>
<td class="colLast">
<div class="block">Uninitialize the policy.</div>
</td>
</tr>
<tr id="i12" class="altColor">
<td class="colFirst"><code>default void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateBookieInfo(java.util.Map)">updateBookieInfo</a></span>&#8203;(java.util.Map&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>,&#8203;<a href="BookieInfoReader.BookieInfo.html" title="class in org.apache.bookkeeper.client">BookieInfoReader.BookieInfo</a>&gt;&nbsp;bookieInfoMap)</code></th>
<td class="colLast">
<div class="block">Send the bookie info details.</div>
</td>
</tr>
</table>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="initialize(org.apache.bookkeeper.conf.ClientConfiguration,java.util.Optional,io.netty.util.HashedWheelTimer,org.apache.bookkeeper.feature.FeatureProvider,org.apache.bookkeeper.stats.StatsLogger,org.apache.bookkeeper.proto.BookieAddressResolver)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>initialize</h4>
<pre class="methodSignature"><a href="EnsemblePlacementPolicy.html" title="interface in org.apache.bookkeeper.client">EnsemblePlacementPolicy</a>&nbsp;initialize&#8203;(<a href="../conf/ClientConfiguration.html" title="class in org.apache.bookkeeper.conf">ClientConfiguration</a>&nbsp;conf,
                                   java.util.Optional&lt;<a href="../net/DNSToSwitchMapping.html" title="interface in org.apache.bookkeeper.net">DNSToSwitchMapping</a>&gt;&nbsp;optionalDnsResolver,
                                   io.netty.util.HashedWheelTimer&nbsp;hashedWheelTimer,
                                   <a href="../feature/FeatureProvider.html" title="interface in org.apache.bookkeeper.feature">FeatureProvider</a>&nbsp;featureProvider,
                                   <a href="../stats/StatsLogger.html" title="interface in org.apache.bookkeeper.stats">StatsLogger</a>&nbsp;statsLogger,
                                   <a href="../proto/BookieAddressResolver.html" title="interface in org.apache.bookkeeper.proto">BookieAddressResolver</a>&nbsp;bookieAddressResolver)</pre>
<div class="block">Initialize the policy.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>conf</code> - client configuration</dd>
<dd><code>optionalDnsResolver</code> - dns resolver</dd>
<dd><code>hashedWheelTimer</code> - timer</dd>
<dd><code>featureProvider</code> - feature provider</dd>
<dd><code>statsLogger</code> - stats logger</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.5</dd>
</dl>
</li>
</ul>
<a id="uninitalize()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>uninitalize</h4>
<pre class="methodSignature">void&nbsp;uninitalize()</pre>
<div class="block">Uninitialize the policy.</div>
</li>
</ul>
<a id="onClusterChanged(java.util.Set,java.util.Set)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>onClusterChanged</h4>
<pre class="methodSignature">java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;onClusterChanged&#8203;(java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;writableBookies,
                                         java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;readOnlyBookies)</pre>
<div class="block">A consistent view of the cluster (what bookies are available as writable, what bookies are available as
 readonly) is updated when any changes happen in the cluster.

 <p>The implementation should take actions when the cluster view is changed. So subsequent
 <a href="#newEnsemble(int,int,int,java.util.Map,java.util.Set)"><code>newEnsemble(int, int, int, Map, Set)</code></a> and
 <a href="#replaceBookie(int,int,int,java.util.Map,java.util.List,org.apache.bookkeeper.net.BookieId,java.util.Set)"><code>replaceBookie(int, int, int, java.util.Map, java.util.List, BookieId, java.util.Set)</code></a>
 can choose proper bookies.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>writableBookies</code> - All the bookies in the cluster available for write/read.</dd>
<dd><code>readOnlyBookies</code> - All the bookies in the cluster available for readonly.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the dead bookies during this cluster change.</dd>
</dl>
</li>
</ul>
<a id="newEnsemble(int,int,int,java.util.Map,java.util.Set)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>newEnsemble</h4>
<pre class="methodSignature"><a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&gt;&nbsp;newEnsemble&#8203;(int&nbsp;ensembleSize,
                                                                              int&nbsp;writeQuorumSize,
                                                                              int&nbsp;ackQuorumSize,
                                                                              java.util.Map&lt;java.lang.String,&#8203;byte[]&gt;&nbsp;customMetadata,
                                                                              java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies)
                                                                       throws <a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client">BKException.BKNotEnoughBookiesException</a></pre>
<div class="block">Choose <i>numBookies</i> bookies for ensemble. If the count is more than the number of available
 nodes, <a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client"><code>BKException.BKNotEnoughBookiesException</code></a> is thrown.

 <p>The implementation should respect to the replace settings. The size of the returned bookie list
 should be equal to the provide <code>ensembleSize</code>.

 <p><code>customMetadata</code> is the same user defined data that user provides
 when <a href="BookKeeper.html#createLedger(int,int,int,org.apache.bookkeeper.client.BookKeeper.DigestType,byte%5B%5D,java.util.Map)"><code>BookKeeper.createLedger(int, int, int, BookKeeper.DigestType, byte[], Map)</code></a>.

 <p>If 'enforceMinNumRacksPerWriteQuorum' config is enabled then the bookies belonging to default
 faultzone (rack) will be excluded while selecting bookies.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensembleSize</code> - Ensemble Size</dd>
<dd><code>writeQuorumSize</code> - Write Quorum Size</dd>
<dd><code>ackQuorumSize</code> - the value of ackQuorumSize (added since 4.5)</dd>
<dd><code>customMetadata</code> - the value of customMetadata. it is the same user defined metadata that user
                       provides in <a href="BookKeeper.html#createLedger(int,int,int,org.apache.bookkeeper.client.BookKeeper.DigestType,byte%5B%5D)"><code>BookKeeper.createLedger(int, int, int, BookKeeper.DigestType, byte[])</code></a></dd>
<dd><code>excludeBookies</code> - Bookies that should not be considered as targets.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a placement result containing list of bookie addresses for the ensemble.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client">BKException.BKNotEnoughBookiesException</a></code> - if not enough bookies available.</dd>
</dl>
</li>
</ul>
<a id="replaceBookie(int,int,int,java.util.Map,java.util.List,org.apache.bookkeeper.net.BookieId,java.util.Set)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>replaceBookie</h4>
<pre class="methodSignature"><a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;replaceBookie&#8203;(int&nbsp;ensembleSize,
                                                                int&nbsp;writeQuorumSize,
                                                                int&nbsp;ackQuorumSize,
                                                                java.util.Map&lt;java.lang.String,&#8203;byte[]&gt;&nbsp;customMetadata,
                                                                java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;currentEnsemble,
                                                                <a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieToReplace,
                                                                java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies)
                                                         throws <a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client">BKException.BKNotEnoughBookiesException</a></pre>
<div class="block">Choose a new bookie to replace <i>bookieToReplace</i>. If no bookie available in the cluster,
 <a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client"><code>BKException.BKNotEnoughBookiesException</code></a> is thrown.

 <p>If 'enforceMinNumRacksPerWriteQuorum' config is enabled then the bookies belonging to default
 faultzone (rack) will be excluded while selecting bookies.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensembleSize</code> - the value of ensembleSize</dd>
<dd><code>writeQuorumSize</code> - the value of writeQuorumSize</dd>
<dd><code>ackQuorumSize</code> - the value of ackQuorumSize (added since 4.5)</dd>
<dd><code>customMetadata</code> - the value of customMetadata. it is the same user defined metadata that user
                       provides in <a href="BookKeeper.html#createLedger(int,int,int,org.apache.bookkeeper.client.BookKeeper.DigestType,byte%5B%5D)"><code>BookKeeper.createLedger(int, int, int, BookKeeper.DigestType, byte[])</code></a></dd>
<dd><code>currentEnsemble</code> - the value of currentEnsemble</dd>
<dd><code>bookieToReplace</code> - bookie to replace</dd>
<dd><code>excludeBookies</code> - bookies that should not be considered as candidate.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a placement result containing the new bookie address.</dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code><a href="BKException.BKNotEnoughBookiesException.html" title="class in org.apache.bookkeeper.client">BKException.BKNotEnoughBookiesException</a></code></dd>
</dl>
</li>
</ul>
<a id="registerSlowBookie(org.apache.bookkeeper.net.BookieId,long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>registerSlowBookie</h4>
<pre class="methodSignature">void&nbsp;registerSlowBookie&#8203;(<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieSocketAddress,
                        long&nbsp;entryId)</pre>
<div class="block">Register a bookie as slow so that it is tried after available and read-only bookies.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>bookieSocketAddress</code> - Address of bookie host</dd>
<dd><code>entryId</code> - Entry ID that caused a speculative timeout on the bookie.</dd>
</dl>
</li>
</ul>
<a id="reorderReadSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reorderReadSequence</h4>
<pre class="methodSignature"><a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;reorderReadSequence&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensemble,
                                                  <a href="BookiesHealthInfo.html" title="interface in org.apache.bookkeeper.client">BookiesHealthInfo</a>&nbsp;bookiesHealthInfo,
                                                  <a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;writeSet)</pre>
<div class="block">Reorder the read sequence of a given write quorum <i>writeSet</i>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensemble</code> - Ensemble to read entries.</dd>
<dd><code>bookiesHealthInfo</code> - Health info for bookies</dd>
<dd><code>writeSet</code> - Write quorum to read entries. This will be modified, rather than
          allocating a new WriteSet.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The read sequence. This will be the same object as the passed in
         writeSet.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.5</dd>
</dl>
</li>
</ul>
<a id="reorderReadLACSequence(java.util.List,org.apache.bookkeeper.client.BookiesHealthInfo,org.apache.bookkeeper.client.DistributionSchedule.WriteSet)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>reorderReadLACSequence</h4>
<pre class="methodSignature"><a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;reorderReadLACSequence&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensemble,
                                                     <a href="BookiesHealthInfo.html" title="interface in org.apache.bookkeeper.client">BookiesHealthInfo</a>&nbsp;bookiesHealthInfo,
                                                     <a href="DistributionSchedule.WriteSet.html" title="interface in org.apache.bookkeeper.client">DistributionSchedule.WriteSet</a>&nbsp;writeSet)</pre>
<div class="block">Reorder the read last add confirmed sequence of a given write quorum <i>writeSet</i>.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensemble</code> - Ensemble to read entries.</dd>
<dd><code>bookiesHealthInfo</code> - Health info for bookies</dd>
<dd><code>writeSet</code> - Write quorum to read entries. This will be modified, rather than
          allocating a new WriteSet.</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The read sequence. This will be the same object as the passed in
         writeSet.</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.5</dd>
</dl>
</li>
</ul>
<a id="updateBookieInfo(java.util.Map)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateBookieInfo</h4>
<pre class="methodSignature">default&nbsp;void&nbsp;updateBookieInfo&#8203;(java.util.Map&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>,&#8203;<a href="BookieInfoReader.BookieInfo.html" title="class in org.apache.bookkeeper.client">BookieInfoReader.BookieInfo</a>&gt;&nbsp;bookieInfoMap)</pre>
<div class="block">Send the bookie info details.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>bookieInfoMap</code> - A map that has the bookie to BookieInfo</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.5</dd>
</dl>
</li>
</ul>
<a id="getStickyReadBookieIndex(org.apache.bookkeeper.client.api.LedgerMetadata,java.util.Optional)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getStickyReadBookieIndex</h4>
<pre class="methodSignature">default&nbsp;int&nbsp;getStickyReadBookieIndex&#8203;(<a href="api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                                     java.util.Optional&lt;java.lang.Integer&gt;&nbsp;currentStickyBookieIndex)</pre>
<div class="block">Select one bookie to the "sticky" bookie where all reads for a particular
 ledger will be directed to.

 <p>The default implementation will pick a bookie randomly from the ensemble.
 Other placement policies will be able to do better decisions based on
 additional information (eg: rack or region awareness).</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>metadata</code> - the <a href="api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api"><code>LedgerMetadata</code></a> object</dd>
<dd><code>currentStickyBookieIndex</code> - if we are changing the sticky bookie after a read failure, the
            current sticky bookie is passed in so that we will avoid
            choosing it again</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the index, within the ensemble of the bookie chosen as the sticky
         bookie</dd>
<dt><span class="simpleTagLabel">Since:</span></dt>
<dd>4.9</dd>
</dl>
</li>
</ul>
<a id="isEnsembleAdheringToPlacementPolicy(java.util.List,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isEnsembleAdheringToPlacementPolicy</h4>
<pre class="methodSignature">default&nbsp;<a href="EnsemblePlacementPolicy.PlacementPolicyAdherence.html" title="enum in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementPolicyAdherence</a>&nbsp;isEnsembleAdheringToPlacementPolicy&#8203;(java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ensembleList,
                                                                                             int&nbsp;writeQuorumSize,
                                                                                             int&nbsp;ackQuorumSize)</pre>
<div class="block">returns AdherenceLevel if the Ensemble is strictly/softly/fails adhering
 to placement policy, like in the case of
 RackawareEnsemblePlacementPolicy, bookies in the writeset are from
 'minNumRacksPerWriteQuorum' number of racks. And in the case of
 RegionawareEnsemblePlacementPolicy, check for
 minimumRegionsForDurability, reppRegionsToWrite, rack distribution within
 a region and other parameters of RegionAwareEnsemblePlacementPolicy. In
 ZoneAwareEnsemblePlacementPolicy if bookies in the writeset are from
 'desiredNumOfZones' then it is considered as MEETS_STRICT if they are
 from 'minNumOfZones' then it is considered as MEETS_SOFT otherwise
 considered as FAIL.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensembleList</code> - list of BookieId of bookies in the ensemble</dd>
<dd><code>writeQuorumSize</code> - writeQuorumSize of the ensemble</dd>
<dd><code>ackQuorumSize</code> - ackQuorumSize of the ensemble</dd>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="areAckedBookiesAdheringToPlacementPolicy(java.util.Set,int,int)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>areAckedBookiesAdheringToPlacementPolicy</h4>
<pre class="methodSignature">default&nbsp;boolean&nbsp;areAckedBookiesAdheringToPlacementPolicy&#8203;(java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;ackedBookies,
                                                         int&nbsp;writeQuorumSize,
                                                         int&nbsp;ackQuorumSize)</pre>
<div class="block">Returns true if the bookies that have acknowledged a write adhere to the minimum fault domains as defined in the
 placement policy in use. Ex: In the case of RackawareEnsemblePlacementPolicy, bookies belong to at least
 'minNumRacksPerWriteQuorum' number of racks.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ackedBookies</code> - list of BookieId of bookies that have acknowledged a write.</dd>
<dd><code>writeQuorumSize</code> - writeQuorumSize of the ensemble</dd>
<dd><code>ackQuorumSize</code> - ackQuorumSize of the ensemble</dd>
<dt><span class="returnLabel">Returns:</span></dt>
</dl>
</li>
</ul>
<a id="replaceToAdherePlacementPolicy(int,int,int,java.util.Set,java.util.List)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>replaceToAdherePlacementPolicy</h4>
<pre class="methodSignature">default&nbsp;<a href="EnsemblePlacementPolicy.PlacementResult.html" title="class in org.apache.bookkeeper.client">EnsemblePlacementPolicy.PlacementResult</a>&lt;java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&gt;&nbsp;replaceToAdherePlacementPolicy&#8203;(int&nbsp;ensembleSize,
                                                                                                         int&nbsp;writeQuorumSize,
                                                                                                         int&nbsp;ackQuorumSize,
                                                                                                         java.util.Set&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;excludeBookies,
                                                                                                         java.util.List&lt;<a href="../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&gt;&nbsp;currentEnsemble)</pre>
<div class="block">Returns placement result. If the currentEnsemble is not adhering placement policy, returns new ensemble that
 adheres placement policy. It should be implemented so as to minify the number of bookies replaced.</div>
<dl>
<dt><span class="paramLabel">Parameters:</span></dt>
<dd><code>ensembleSize</code> - ensemble size</dd>
<dd><code>writeQuorumSize</code> - writeQuorumSize of the ensemble</dd>
<dd><code>ackQuorumSize</code> - ackQuorumSize of the ensemble</dd>
<dd><code>excludeBookies</code> - bookies that should not be considered as targets</dd>
<dd><code>currentEnsemble</code> - current ensemble</dd>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a placement result</dd>
</dl>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/EnsemblePlacementPolicy.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../index-all.html">Index</a></li>
<li><a href="../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li>Constr&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2011&#x2013;2023 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</body>
</html>
