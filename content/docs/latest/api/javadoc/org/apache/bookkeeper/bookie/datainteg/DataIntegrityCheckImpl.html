<!DOCTYPE HTML>
<!-- NewPage -->
<html lang="en">
<head>
<!-- Generated by javadoc -->
<title>DataIntegrityCheckImpl (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)</title>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<link rel="stylesheet" type="text/css" href="../../../../../stylesheet.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery/jquery-ui.min.css" title="Style">
<link rel="stylesheet" type="text/css" href="../../../../../jquery-ui.overrides.css" title="Style">
<script type="text/javascript" src="../../../../../script.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip/dist/jszip.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils.min.js"></script>
<!--[if IE]>
<script type="text/javascript" src="../../../../../jquery/jszip-utils/dist/jszip-utils-ie.min.js"></script>
<![endif]-->
<script type="text/javascript" src="../../../../../jquery/jquery-3.7.1.min.js"></script>
<script type="text/javascript" src="../../../../../jquery/jquery-ui.min.js"></script>
</head>
<body>
<script type="text/javascript"><!--
    try {
        if (location.href.indexOf('is-external=true') == -1) {
            parent.document.title="DataIntegrityCheckImpl (Apache BookKeeper :: Parent 4.18.0-SNAPSHOT API)";
        }
    }
    catch(err) {
    }
//-->
var data = {"i0":10,"i1":10,"i2":9,"i3":10,"i4":10,"i5":10,"i6":10,"i7":10,"i8":10,"i9":10,"i10":10,"i11":10};
var tabs = {65535:["t0","All Methods"],1:["t1","Static Methods"],2:["t2","Instance Methods"],8:["t4","Concrete Methods"]};
var altColor = "altColor";
var rowColor = "rowColor";
var tableTab = "tableTab";
var activeTableTab = "activeTableTab";
var pathtoroot = "../../../../../";
var useModuleDirectories = true;
loadScripts(document, 'script');</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
<header role="banner">
<nav role="navigation">
<div class="fixedNav">
<!-- ========= START OF TOP NAVBAR ======= -->
<div class="topNav"><a id="navbar.top">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.top" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.top.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DataIntegrityCheckImpl.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_top">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<ul class="navListSearch">
<li><label for="search">SEARCH:</label>
<input type="text" id="search" value="search" disabled="disabled">
<input type="reset" id="reset" value="reset" disabled="disabled">
</li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_top");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.top">
<!--   -->
</a></div>
<!-- ========= END OF TOP NAVBAR ========= -->
</div>
<div class="navPadding">&nbsp;</div>
<script type="text/javascript"><!--
$('.navPadding').css('padding-top', $('.fixedNav').css("height"));
//-->
</script>
</nav>
</header>
<!-- ======== START OF CLASS DATA ======== -->
<main role="main">
<div class="header">
<div class="subTitle"><span class="packageLabelInType">Package</span>&nbsp;<a href="package-summary.html">org.apache.bookkeeper.bookie.datainteg</a></div>
<h2 title="Class DataIntegrityCheckImpl" class="title">Class DataIntegrityCheckImpl</h2>
</div>
<div class="contentContainer">
<ul class="inheritance">
<li>java.lang.Object</li>
<li>
<ul class="inheritance">
<li>org.apache.bookkeeper.bookie.datainteg.DataIntegrityCheckImpl</li>
</ul>
</li>
</ul>
<div class="description">
<ul class="blockList">
<li class="blockList">
<dl>
<dt>All Implemented Interfaces:</dt>
<dd><code><a href="DataIntegrityCheck.html" title="interface in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheck</a></code></dd>
</dl>
<hr>
<pre>public class <span class="typeNameLabel">DataIntegrityCheckImpl</span>
extends java.lang.Object
implements <a href="DataIntegrityCheck.html" title="interface in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheck</a></pre>
<div class="block">An implementation of the DataIntegrityCheck interface.</div>
</li>
</ul>
</div>
<div class="summary">
<ul class="blockList">
<li class="blockList">
<!-- ======== NESTED CLASS SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="nested.class.summary">
<!--   -->
</a>
<h3>Nested Class Summary</h3>
<table class="memberSummary">
<caption><span>Nested Classes</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Class</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<td class="colFirst"><code>(package private) static class&nbsp;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="DataIntegrityCheckImpl.LedgerResult.html" title="class in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheckImpl.LedgerResult</a></span></code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ======== CONSTRUCTOR SUMMARY ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.summary">
<!--   -->
</a>
<h3>Constructor Summary</h3>
<table class="memberSummary">
<caption><span>Constructors</span><span class="tabEnd">&nbsp;</span></caption>
<tr>
<th class="colFirst" scope="col">Constructor</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr class="altColor">
<th class="colConstructorName" scope="row"><code><span class="memberNameLink"><a href="#%3Cinit%3E(org.apache.bookkeeper.net.BookieId,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerStorage,org.apache.bookkeeper.bookie.datainteg.EntryCopier,org.apache.bookkeeper.client.BookKeeperAdmin,io.reactivex.rxjava3.core.Scheduler)">DataIntegrityCheckImpl</a></span>&#8203;(<a href="../../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieId,
                      <a href="../../meta/LedgerManager.html" title="interface in org.apache.bookkeeper.meta">LedgerManager</a>&nbsp;ledgerManager,
                      <a href="../LedgerStorage.html" title="interface in org.apache.bookkeeper.bookie">LedgerStorage</a>&nbsp;ledgerStorage,
                      <a href="EntryCopier.html" title="interface in org.apache.bookkeeper.bookie.datainteg">EntryCopier</a>&nbsp;entryCopier,
                      <a href="../../client/BookKeeperAdmin.html" title="class in org.apache.bookkeeper.client">BookKeeperAdmin</a>&nbsp;admin,
                      io.reactivex.rxjava3.core.Scheduler&nbsp;scheduler)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
</li>
</ul>
</section>
<!-- ========== METHOD SUMMARY =========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.summary">
<!--   -->
</a>
<h3>Method Summary</h3>
<table class="memberSummary">
<caption><span id="t0" class="activeTableTab"><span>All Methods</span><span class="tabEnd">&nbsp;</span></span><span id="t1" class="tableTab"><span><a href="javascript:show(1);">Static Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t2" class="tableTab"><span><a href="javascript:show(2);">Instance Methods</a></span><span class="tabEnd">&nbsp;</span></span><span id="t4" class="tableTab"><span><a href="javascript:show(8);">Concrete Methods</a></span><span class="tabEnd">&nbsp;</span></span></caption>
<tr>
<th class="colFirst" scope="col">Modifier and Type</th>
<th class="colSecond" scope="col">Method</th>
<th class="colLast" scope="col">Description</th>
</tr>
<tr id="i0" class="altColor">
<td class="colFirst"><code>(package private) io.reactivex.rxjava3.core.Single&lt;java.lang.Long&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#checkAndRecoverLedgerEntries(long,org.apache.bookkeeper.client.api.LedgerMetadata,java.lang.String)">checkAndRecoverLedgerEntries</a></span>&#8203;(long&nbsp;ledgerId,
                            <a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                            java.lang.String&nbsp;runId)</code></th>
<td class="colLast">
<div class="block">Check whether the local storage has all the entries as specified in the metadata.</div>
</td>
</tr>
<tr id="i1" class="rowColor">
<td class="colFirst"><code>(package private) java.util.concurrent.CompletableFuture&lt;java.util.Set&lt;<a href="DataIntegrityCheckImpl.LedgerResult.html" title="class in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheckImpl.LedgerResult</a>&gt;&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#checkAndRecoverLedgers(java.util.Map,java.lang.String)">checkAndRecoverLedgers</a></span>&#8203;(java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;ledgers,
                      java.lang.String&nbsp;runId)</code></th>
<td class="colLast">
<div class="block">Check each ledger passed.</div>
</td>
</tr>
<tr id="i2" class="altColor">
<td class="colFirst"><code>(package private) static boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#ensemblesContainBookie(org.apache.bookkeeper.client.api.LedgerMetadata,org.apache.bookkeeper.net.BookieId)">ensemblesContainBookie</a></span>&#8203;(<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                      <a href="../../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieId)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i3" class="rowColor">
<td class="colFirst"><code>(package private) java.util.concurrent.CompletableFuture&lt;java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#getCachedOrReadMetadata(java.lang.String)">getCachedOrReadMetadata</a></span>&#8203;(java.lang.String&nbsp;runId)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i4" class="altColor">
<td class="colFirst"><code>(package private) boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#isEntryMissing(org.apache.bookkeeper.bookie.datainteg.WriteSets,java.util.NavigableMap,long,long)">isEntryMissing</a></span>&#8203;(<a href="WriteSets.html" title="class in org.apache.bookkeeper.bookie.datainteg">WriteSets</a>&nbsp;writeSets,
              java.util.NavigableMap&lt;java.lang.Long,&#8203;java.lang.Integer&gt;&nbsp;bookieIndices,
              long&nbsp;ledgerId,
              long&nbsp;entryId)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i5" class="rowColor">
<td class="colFirst"><code>(package private) io.reactivex.rxjava3.core.Maybe&lt;java.lang.Long&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#maybeCopyEntry(org.apache.bookkeeper.bookie.datainteg.WriteSets,java.util.NavigableMap,long,long,org.apache.bookkeeper.bookie.datainteg.EntryCopier.Batch)">maybeCopyEntry</a></span>&#8203;(<a href="WriteSets.html" title="class in org.apache.bookkeeper.bookie.datainteg">WriteSets</a>&nbsp;writeSets,
              java.util.NavigableMap&lt;java.lang.Long,&#8203;java.lang.Integer&gt;&nbsp;bookieIndices,
              long&nbsp;ledgerId,
              long&nbsp;entryId,
              <a href="EntryCopier.Batch.html" title="interface in org.apache.bookkeeper.bookie.datainteg">EntryCopier.Batch</a>&nbsp;batch)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i6" class="altColor">
<td class="colFirst"><code>boolean</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#needsFullCheck()">needsFullCheck</a></span>()</code></th>
<td class="colLast">
<div class="block">Whether we need to run a full check.</div>
</td>
</tr>
<tr id="i7" class="rowColor">
<td class="colFirst"><code>(package private) io.reactivex.rxjava3.core.Single&lt;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#recoverLedger(long,java.lang.String)">recoverLedger</a></span>&#8203;(long&nbsp;ledgerId,
             java.lang.String&nbsp;runId)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
<tr id="i8" class="altColor">
<td class="colFirst"><code>(package private) io.reactivex.rxjava3.core.Maybe&lt;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#recoverLedgerIfInLimbo(long,org.apache.bookkeeper.client.api.LedgerMetadata,java.lang.String)">recoverLedgerIfInLimbo</a></span>&#8203;(long&nbsp;ledgerId,
                      <a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;origMetadata,
                      java.lang.String&nbsp;runId)</code></th>
<td class="colLast">
<div class="block">Run ledger recovery on all a ledger if it has been marked as in limbo.</div>
</td>
</tr>
<tr id="i9" class="rowColor">
<td class="colFirst"><code>java.util.concurrent.CompletableFuture&lt;java.lang.Void&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#runFullCheck()">runFullCheck</a></span>()</code></th>
<td class="colLast">
<div class="block">Run full check of bookies local data.</div>
</td>
</tr>
<tr id="i10" class="altColor">
<td class="colFirst"><code>java.util.concurrent.CompletableFuture&lt;java.lang.Void&gt;</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#runPreBootCheck(java.lang.String)">runPreBootCheck</a></span>&#8203;(java.lang.String&nbsp;reason)</code></th>
<td class="colLast">
<div class="block">Run quick preboot check.</div>
</td>
</tr>
<tr id="i11" class="rowColor">
<td class="colFirst"><code>(package private) void</code></td>
<th class="colSecond" scope="row"><code><span class="memberNameLink"><a href="#updateMetadataCache(java.util.Map)">updateMetadataCache</a></span>&#8203;(java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;ledgers)</code></th>
<td class="colLast">&nbsp;</td>
</tr>
</table>
<ul class="blockList">
<li class="blockList"><a id="methods.inherited.from.class.java.lang.Object">
<!--   -->
</a>
<h3>Methods inherited from class&nbsp;java.lang.Object</h3>
<code>clone, equals, finalize, getClass, hashCode, notify, notifyAll, toString, wait, wait, wait</code></li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
<div class="details">
<ul class="blockList">
<li class="blockList">
<!-- ========= CONSTRUCTOR DETAIL ======== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="constructor.detail">
<!--   -->
</a>
<h3>Constructor Detail</h3>
<a id="&lt;init&gt;(org.apache.bookkeeper.net.BookieId,org.apache.bookkeeper.meta.LedgerManager,org.apache.bookkeeper.bookie.LedgerStorage,org.apache.bookkeeper.bookie.datainteg.EntryCopier,org.apache.bookkeeper.client.BookKeeperAdmin,io.reactivex.rxjava3.core.Scheduler)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>DataIntegrityCheckImpl</h4>
<pre>public&nbsp;DataIntegrityCheckImpl&#8203;(<a href="../../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieId,
                              <a href="../../meta/LedgerManager.html" title="interface in org.apache.bookkeeper.meta">LedgerManager</a>&nbsp;ledgerManager,
                              <a href="../LedgerStorage.html" title="interface in org.apache.bookkeeper.bookie">LedgerStorage</a>&nbsp;ledgerStorage,
                              <a href="EntryCopier.html" title="interface in org.apache.bookkeeper.bookie.datainteg">EntryCopier</a>&nbsp;entryCopier,
                              <a href="../../client/BookKeeperAdmin.html" title="class in org.apache.bookkeeper.client">BookKeeperAdmin</a>&nbsp;admin,
                              io.reactivex.rxjava3.core.Scheduler&nbsp;scheduler)</pre>
</li>
</ul>
</li>
</ul>
</section>
<!-- ============ METHOD DETAIL ========== -->
<section>
<ul class="blockList">
<li class="blockList"><a id="method.detail">
<!--   -->
</a>
<h3>Method Detail</h3>
<a id="runPreBootCheck(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>runPreBootCheck</h4>
<pre class="methodSignature">public&nbsp;java.util.concurrent.CompletableFuture&lt;java.lang.Void&gt;&nbsp;runPreBootCheck&#8203;(java.lang.String&nbsp;reason)</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="DataIntegrityCheck.html#runPreBootCheck(java.lang.String)">DataIntegrityCheck</a></code></span></div>
<div class="block">Run quick preboot check. This check should do enough to ensure that
 it is safe to complete the boot sequence without compromising correctness.
 To this end, if it finds that this bookie is part of the last ensemble of
 an unclosed ledger, it must prevent the bookie from being able store new
 entries for that ledger and must prevent the bookie from taking part in
 the discovery of the last entry of that ledger.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="DataIntegrityCheck.html#runPreBootCheck(java.lang.String)">runPreBootCheck</a></code>&nbsp;in interface&nbsp;<code><a href="DataIntegrityCheck.html" title="interface in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheck</a></code></dd>
</dl>
</li>
</ul>
<a id="needsFullCheck()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>needsFullCheck</h4>
<pre class="methodSignature">public&nbsp;boolean&nbsp;needsFullCheck()
                       throws java.io.IOException</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="DataIntegrityCheck.html#needsFullCheck()">DataIntegrityCheck</a></code></span></div>
<div class="block">Whether we need to run a full check.
 This condition can be set by the runPreBoot() call to run a full check
 in the background once the bookie is running. This can later be used
 to run the full check periodically, or to exponentially backoff and retry
 when some transient condition prevents a ledger being fixed during a
 full check.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="DataIntegrityCheck.html#needsFullCheck()">needsFullCheck</a></code>&nbsp;in interface&nbsp;<code><a href="DataIntegrityCheck.html" title="interface in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheck</a></code></dd>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
</dl>
</li>
</ul>
<a id="runFullCheck()">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>runFullCheck</h4>
<pre class="methodSignature">public&nbsp;java.util.concurrent.CompletableFuture&lt;java.lang.Void&gt;&nbsp;runFullCheck()</pre>
<div class="block"><span class="descfrmTypeLabel">Description copied from interface:&nbsp;<code><a href="DataIntegrityCheck.html#runFullCheck()">DataIntegrityCheck</a></code></span></div>
<div class="block">Run full check of bookies local data. This check should ensure that
 if the metadata service states that it should have an entry, then it
 should have that entry. If the entry is missing, it should copy it
 from another available source.</div>
<dl>
<dt><span class="overrideSpecifyLabel">Specified by:</span></dt>
<dd><code><a href="DataIntegrityCheck.html#runFullCheck()">runFullCheck</a></code>&nbsp;in interface&nbsp;<code><a href="DataIntegrityCheck.html" title="interface in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheck</a></code></dd>
</dl>
</li>
</ul>
<a id="updateMetadataCache(java.util.Map)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>updateMetadataCache</h4>
<pre class="methodSignature">void&nbsp;updateMetadataCache&#8203;(java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;ledgers)</pre>
</li>
</ul>
<a id="getCachedOrReadMetadata(java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>getCachedOrReadMetadata</h4>
<pre class="methodSignature">java.util.concurrent.CompletableFuture&lt;java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&gt;&nbsp;getCachedOrReadMetadata&#8203;(java.lang.String&nbsp;runId)</pre>
</li>
</ul>
<a id="checkAndRecoverLedgers(java.util.Map,java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkAndRecoverLedgers</h4>
<pre class="methodSignature">java.util.concurrent.CompletableFuture&lt;java.util.Set&lt;<a href="DataIntegrityCheckImpl.LedgerResult.html" title="class in org.apache.bookkeeper.bookie.datainteg">DataIntegrityCheckImpl.LedgerResult</a>&gt;&gt;&nbsp;checkAndRecoverLedgers&#8203;(java.util.Map&lt;java.lang.Long,&#8203;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;ledgers,
                                                                                                                  java.lang.String&nbsp;runId)</pre>
<div class="block">Check each ledger passed.
 If the ledger is in limbo, recover it.
 Check that the bookie has all entries that it is expected to have.
 Copy any entries that are missing.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>The set of results for all ledgers passed. A result can be OK, Missing or Error.
         OK and missing ledgers do not need to be looked at again. Error should be retried.</dd>
</dl>
</li>
</ul>
<a id="recoverLedgerIfInLimbo(long,org.apache.bookkeeper.client.api.LedgerMetadata,java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>recoverLedgerIfInLimbo</h4>
<pre class="methodSignature">io.reactivex.rxjava3.core.Maybe&lt;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;recoverLedgerIfInLimbo&#8203;(long&nbsp;ledgerId,
                                                                       <a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;origMetadata,
                                                                       java.lang.String&nbsp;runId)</pre>
<div class="block">Run ledger recovery on all a ledger if it has been marked as in limbo.</div>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>a maybe with the most up-to-date metadata we have for the ledger.
         If the ledger has been deleted, returns empty.</dd>
</dl>
</li>
</ul>
<a id="recoverLedger(long,java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>recoverLedger</h4>
<pre class="methodSignature">io.reactivex.rxjava3.core.Single&lt;<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&gt;&nbsp;recoverLedger&#8203;(long&nbsp;ledgerId,
                                                               java.lang.String&nbsp;runId)</pre>
</li>
</ul>
<a id="checkAndRecoverLedgerEntries(long,org.apache.bookkeeper.client.api.LedgerMetadata,java.lang.String)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>checkAndRecoverLedgerEntries</h4>
<pre class="methodSignature">io.reactivex.rxjava3.core.Single&lt;java.lang.Long&gt;&nbsp;checkAndRecoverLedgerEntries&#8203;(long&nbsp;ledgerId,
                                                                              <a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                                                                              java.lang.String&nbsp;runId)</pre>
<div class="block">Check whether the local storage has all the entries as specified in the metadata.
 If not, copy them from other available nodes.
 Returns a single value which is the ledgerId or an error if any entry failed to copy
 should throw error if any entry failed to copy.</div>
</li>
</ul>
<a id="maybeCopyEntry(org.apache.bookkeeper.bookie.datainteg.WriteSets,java.util.NavigableMap,long,long,org.apache.bookkeeper.bookie.datainteg.EntryCopier.Batch)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>maybeCopyEntry</h4>
<pre class="methodSignature">io.reactivex.rxjava3.core.Maybe&lt;java.lang.Long&gt;&nbsp;maybeCopyEntry&#8203;(<a href="WriteSets.html" title="class in org.apache.bookkeeper.bookie.datainteg">WriteSets</a>&nbsp;writeSets,
                                                               java.util.NavigableMap&lt;java.lang.Long,&#8203;java.lang.Integer&gt;&nbsp;bookieIndices,
                                                               long&nbsp;ledgerId,
                                                               long&nbsp;entryId,
                                                               <a href="EntryCopier.Batch.html" title="interface in org.apache.bookkeeper.bookie.datainteg">EntryCopier.Batch</a>&nbsp;batch)</pre>
<dl>
<dt><span class="returnLabel">Returns:</span></dt>
<dd>the number of bytes copied.</dd>
</dl>
</li>
</ul>
<a id="isEntryMissing(org.apache.bookkeeper.bookie.datainteg.WriteSets,java.util.NavigableMap,long,long)">
<!--   -->
</a>
<ul class="blockList">
<li class="blockList">
<h4>isEntryMissing</h4>
<pre class="methodSignature">boolean&nbsp;isEntryMissing&#8203;(<a href="WriteSets.html" title="class in org.apache.bookkeeper.bookie.datainteg">WriteSets</a>&nbsp;writeSets,
                       java.util.NavigableMap&lt;java.lang.Long,&#8203;java.lang.Integer&gt;&nbsp;bookieIndices,
                       long&nbsp;ledgerId,
                       long&nbsp;entryId)
                throws java.io.IOException,
                       <a href="../BookieException.html" title="class in org.apache.bookkeeper.bookie">BookieException</a></pre>
<dl>
<dt><span class="throwsLabel">Throws:</span></dt>
<dd><code>java.io.IOException</code></dd>
<dd><code><a href="../BookieException.html" title="class in org.apache.bookkeeper.bookie">BookieException</a></code></dd>
</dl>
</li>
</ul>
<a id="ensemblesContainBookie(org.apache.bookkeeper.client.api.LedgerMetadata,org.apache.bookkeeper.net.BookieId)">
<!--   -->
</a>
<ul class="blockListLast">
<li class="blockList">
<h4>ensemblesContainBookie</h4>
<pre class="methodSignature">static&nbsp;boolean&nbsp;ensemblesContainBookie&#8203;(<a href="../../client/api/LedgerMetadata.html" title="interface in org.apache.bookkeeper.client.api">LedgerMetadata</a>&nbsp;metadata,
                                      <a href="../../net/BookieId.html" title="class in org.apache.bookkeeper.net">BookieId</a>&nbsp;bookieId)</pre>
</li>
</ul>
</li>
</ul>
</section>
</li>
</ul>
</div>
</div>
</main>
<!-- ========= END OF CLASS DATA ========= -->
<footer role="contentinfo">
<nav role="navigation">
<!-- ======= START OF BOTTOM NAVBAR ====== -->
<div class="bottomNav"><a id="navbar.bottom">
<!--   -->
</a>
<div class="skipNav"><a href="#skip.navbar.bottom" title="Skip navigation links">Skip navigation links</a></div>
<a id="navbar.bottom.firstrow">
<!--   -->
</a>
<ul class="navList" title="Navigation">
<li><a href="../../../../../index.html">Overview</a></li>
<li><a href="package-summary.html">Package</a></li>
<li class="navBarCell1Rev">Class</li>
<li><a href="class-use/DataIntegrityCheckImpl.html">Use</a></li>
<li><a href="package-tree.html">Tree</a></li>
<li><a href="../../../../../deprecated-list.html">Deprecated</a></li>
<li><a href="../../../../../index-all.html">Index</a></li>
<li><a href="../../../../../help-doc.html">Help</a></li>
</ul>
</div>
<div class="subNav">
<ul class="navList" id="allclasses_navbar_bottom">
<li><a href="../../../../../allclasses.html">All&nbsp;Classes</a></li>
</ul>
<div>
<script type="text/javascript"><!--
  allClassesLink = document.getElementById("allclasses_navbar_bottom");
  if(window==top) {
    allClassesLink.style.display = "block";
  }
  else {
    allClassesLink.style.display = "none";
  }
  //-->
</script>
<noscript>
<div>JavaScript is disabled on your browser.</div>
</noscript>
</div>
<div>
<ul class="subNavList">
<li>Summary:&nbsp;</li>
<li><a href="#nested.class.summary">Nested</a>&nbsp;|&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.summary">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.summary">Method</a></li>
</ul>
<ul class="subNavList">
<li>Detail:&nbsp;</li>
<li>Field&nbsp;|&nbsp;</li>
<li><a href="#constructor.detail">Constr</a>&nbsp;|&nbsp;</li>
<li><a href="#method.detail">Method</a></li>
</ul>
</div>
<a id="skip.navbar.bottom">
<!--   -->
</a></div>
<!-- ======== END OF BOTTOM NAVBAR ======= -->
</nav>
<p class="legalCopy"><small>Copyright &#169; 2011&#x2013;2023 <a href="https://www.apache.org/">The Apache Software Foundation</a>. All rights reserved.</small></p>
</footer>
</body>
</html>
