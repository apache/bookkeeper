<!doctype html>
<html class="docs-version-4.10.0" lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.0-beta.17">
<title data-rh="true">Deploying Apache BookKeeper on Kubernetes | Apache BookKeeper</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:url" content="https://bookkeeper.staged.apache.org//docs/4.10.0/deployment/kubernetes"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docusaurus_version" content="4.10.0"><meta data-rh="true" name="docusaurus_tag" content="docs-default-4.10.0"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docsearch:version" content="4.10.0"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-4.10.0"><meta data-rh="true" property="og:title" content="Deploying Apache BookKeeper on Kubernetes | Apache BookKeeper"><meta data-rh="true" name="description" content="Apache BookKeeper can be easily deployed in Kubernetes clusters. The managed clusters on Google Container Engine is the most convenient way."><meta data-rh="true" property="og:description" content="Apache BookKeeper can be easily deployed in Kubernetes clusters. The managed clusters on Google Container Engine is the most convenient way."><link data-rh="true" rel="icon" href="/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://bookkeeper.staged.apache.org//docs/4.10.0/deployment/kubernetes"><link data-rh="true" rel="alternate" href="https://bookkeeper.staged.apache.org//docs/4.10.0/deployment/kubernetes" hreflang="en"><link data-rh="true" rel="alternate" href="https://bookkeeper.staged.apache.org//docs/4.10.0/deployment/kubernetes" hreflang="x-default"><link rel="stylesheet" href="/assets/css/styles.4caf24b3.css">
<link rel="preload" href="/assets/js/runtime~main.2f35421b.js" as="script">
<link rel="preload" href="/assets/js/main.61419cb6.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_ZgBM">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/"><div class="navbar__logo"><img src="/img/bk-logo.svg" alt="Apache Bookkeeper" class="themedImage_W2Cr themedImage--light_TfLj"><img src="/img/bk-logo.svg" alt="Apache Bookkeeper" class="themedImage_W2Cr themedImage--dark_oUvU"></div><b class="navbar__title">Apache BookKeeper</b></a><a class="navbar__item navbar__link navbar__link--active" href="/docs/4.10.0/overview/">Documentation</a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Community</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/community/mailing-lists">Mailing lists</a></li><li><a class="dropdown__link" href="/community/slack">Slack</a></li><li><a href="https://github.com/apache/bookkeeper/issues" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Github issues<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/community/releases">Release management</a></li><li><a class="dropdown__link" href="/community/meeting">Community meetings</a></li><li><a class="dropdown__link" href="/community/contributing">Contribution guide</a></li><li><a class="dropdown__link" href="/community/coding-guide">Coding guide</a></li><li><a class="dropdown__link" href="/community/testing">Testing guide</a></li><li><a class="dropdown__link" href="/community/issue-report">Issue report guide</a></li><li><a class="dropdown__link" href="/community/release-guide">Release guide</a></li><li><a class="dropdown__link" href="/community/presentations">Presentations</a></li><li><a class="dropdown__link" href="/community/bookkeeper-proposals">BookKeeper proposals (BP)</a></li></ul></div><div class="navbar__item dropdown dropdown--hoverable"><a href="#" class="navbar__link">Project</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/project/who">Who are we?</a></li><li><a class="dropdown__link" href="/project/bylaws">Bylaws</a></li><li><a href="https://apache.org/licenses" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>License<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a class="dropdown__link" href="/project/privacy">Privacy policy</a></li><li><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Sponsorship<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="dropdown__link"><span>Thanks<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" href="/docs/4.10.0/overview/">4.10.0</a><ul class="dropdown__menu"><li><a class="dropdown__link" href="/docs/next/deployment/kubernetes">Next</a></li><li><a class="dropdown__link" href="/docs/deployment/kubernetes">4.14.4</a></li><li><a class="dropdown__link" href="/docs/4.13.0/deployment/kubernetes">4.13.0</a></li><li><a class="dropdown__link" href="/docs/4.12.1/deployment/kubernetes">4.12.1</a></li><li><a class="dropdown__link" href="/docs/4.11.1/deployment/kubernetes">4.11.1</a></li><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/docs/4.10.0/deployment/kubernetes">4.10.0</a></li><li><a class="dropdown__link" href="/docs/4.9.2/deployment/kubernetes">4.9.2</a></li><li><a class="dropdown__link" href="/docs/4.8.2/deployment/kubernetes">4.8.2</a></li><li><a class="dropdown__link" href="/docs/4.7.3/deployment/kubernetes">4.7.3</a></li><li><a class="dropdown__link" href="/docs/4.6.2/deployment/kubernetes">4.6.2</a></li><li><a class="dropdown__link" href="/docs/4.5.1/deployment/kubernetes">4.5.1</a></li></ul></div><a class="navbar__item navbar__link" href="/releases">Download</a><div class="toggle_S7eR toggle_TdHA toggleDisabled_f9M3"><div class="toggleButton_rCf9" role="button" tabindex="-1"><svg viewBox="0 0 24 24" width="24" height="24" class="lightToggleIcon_v35p"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" class="darkToggleIcon_nQuB"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg></div><input type="checkbox" class="toggleScreenReader_g2nN" aria-label="Switch between dark and light mode (currently light mode)"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper docs-wrapper docs-doc-page"><div class="docPage_P2Lg"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_RiI4" type="button"></button><aside class="theme-doc-sidebar-container docSidebarContainer_rKC_"><div class="sidebar_CW9Y"><nav class="menu thin-scrollbar menu_SkdO"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/docs/4.10.0/overview/">Overview</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/getting-started/installation">Getting started</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--active" href="/docs/4.10.0/deployment/manual">Deployment</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.10.0/deployment/manual">Manual deployment</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/docs/4.10.0/deployment/dcos">BookKeeper on DC/OS</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/docs/4.10.0/deployment/kubernetes">BookKeeper on Kubernetes</a></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/admin/bookies">Administration</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/api/overview">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/security/overview">Security</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/development/protocol">Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist" href="/docs/4.10.0/reference/config">Reference</a></div></li></ul></nav></div></aside><main class="docMainContainer_TCnq"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_DM6M"><div class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->Apache BookKeeper<!-- --> <b>4.10.0</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/deployment/kubernetes">latest version</a></b> (<!-- -->4.14.4<!-- -->).</div></div><div class="docItemContainer_vinB"><article><span class="theme-doc-version-badge badge badge--secondary">Version: 4.10.0</span><div class="tocCollapsible_jdIR theme-doc-toc-mobile tocMobile_TmEX"><button type="button" class="clean-btn tocCollapsibleButton_Fzxq">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Deploying Apache BookKeeper on Kubernetes</h1></header><p>Apache BookKeeper can be easily deployed in <a href="https://kubernetes.io/" target="_blank" rel="noopener noreferrer">Kubernetes</a> clusters. The managed clusters on <a href="https://cloud.google.com/compute/" target="_blank" rel="noopener noreferrer">Google Container Engine</a> is the most convenient way.</p><p>The deployment method shown in this guide relies on <a href="http://yaml.org/" target="_blank" rel="noopener noreferrer">YAML</a> definitions for Kubernetes <a href="https://kubernetes.io/docs/resources-reference/v1.6/" target="_blank" rel="noopener noreferrer">resources</a>. The <a href="https://github.com/apache/bookkeeper/tree/master/deploy/kubernetes" target="_blank" rel="noopener noreferrer"><code>kubernetes</code></a> subdirectory holds resource definitions for:</p><ul><li>A three-node ZooKeeper cluster</li><li>A BookKeeper cluster with a bookie runs on each node.</li></ul><h2 class="anchor anchorWithStickyNavbar_mojV" id="setup-on-google-container-engine">Setup on Google Container Engine<a class="hash-link" href="#setup-on-google-container-engine" title="Direct link to heading">​</a></h2><p>To get started, get source code of <a href="https://github.com/apache/bookkeeper/tree/master/deploy/kubernetes" target="_blank" rel="noopener noreferrer"><code>kubernetes</code></a> from github by git clone.</p><p>If you&#x27;d like to change the number of bookies,  or ZooKeeper nodes in your BookKeeper cluster, modify the <code>replicas</code> parameter in the <code>spec</code> section of the appropriate <a href="https://kubernetes.io/docs/concepts/workloads/controllers/deployment/" target="_blank" rel="noopener noreferrer"><code>Deployment</code></a> or <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer"><code>StatefulSet</code></a> resource.</p><p><a href="https://cloud.google.com/container-engine" target="_blank" rel="noopener noreferrer">Google Container Engine</a> (GKE) automates the creation and management of Kubernetes clusters in <a href="https://cloud.google.com/compute/" target="_blank" rel="noopener noreferrer">Google Compute Engine</a> (GCE).</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="prerequisites">Prerequisites<a class="hash-link" href="#prerequisites" title="Direct link to heading">​</a></h3><p>To get started, you&#x27;ll need:</p><ul><li>A Google Cloud Platform account, which you can sign up for at <a href="https://cloud.google.com" target="_blank" rel="noopener noreferrer">cloud.google.com</a></li><li>An existing Cloud Platform project</li><li>The <a href="https://cloud.google.com/sdk/downloads" target="_blank" rel="noopener noreferrer">Google Cloud SDK</a> (in particular the <a href="https://cloud.google.com/sdk/gcloud/" target="_blank" rel="noopener noreferrer"><code>gcloud</code></a> and <a href="https://kubernetes.io/docs/tasks/tools/" target="_blank" rel="noopener noreferrer"><code>kubectl</code></a> tools).</li></ul><h3 class="anchor anchorWithStickyNavbar_mojV" id="create-a-new-kubernetes-cluster">Create a new Kubernetes cluster<a class="hash-link" href="#create-a-new-kubernetes-cluster" title="Direct link to heading">​</a></h3><p>You can create a new GKE cluster using the <a href="https://cloud.google.com/sdk/gcloud/reference/container/clusters/create" target="_blank" rel="noopener noreferrer"><code>container clusters create</code></a> command for <code>gcloud</code>. This command enables you to specify the number of nodes in the cluster, the machine types of those nodes, and more.</p><p>As an example, we&#x27;ll create a new GKE cluster for Kubernetes version <a href="https://github.com/kubernetes/kubernetes/blob/master/CHANGELOG.md#v164" target="_blank" rel="noopener noreferrer">1.6.4</a> in the <a href="https://cloud.google.com/compute/docs/regions-zones/regions-zones#available" target="_blank" rel="noopener noreferrer">us-central1-a</a> zone. The cluster will be named <code>bookkeeper-gke-cluster</code> and will consist of three VMs, each using two locally attached SSDs and running on <a href="https://cloud.google.com/compute/docs/machine-types" target="_blank" rel="noopener noreferrer">n1-standard-8</a> machines. These SSDs will be used by Bookie instances, one for the BookKeeper journal and the other for storing the actual data.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> compute/zone us-central1-a</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud config </span><span class="token builtin class-name">set</span><span class="token plain"> project your-project-name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud container clusters create bookkeeper-gke-cluster </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --machine-type</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">n1-standard-8 </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --num-nodes</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">3</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --local-ssd-count</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">2</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --enable-kubernetes-alpha</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>By default, bookies will run on all the machines that have locally attached SSD disks. In this example, all of those machines will have two SSDs, but you can add different types of machines to the cluster later. You can control which machines host bookie servers using <a href="https://kubernetes.io/docs/concepts/overview/working-with-objects/labels" target="_blank" rel="noopener noreferrer">labels</a>.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="dashboard">Dashboard<a class="hash-link" href="#dashboard" title="Direct link to heading">​</a></h3><p>You can observe your cluster in the <a href="https://kubernetes.io/docs/tasks/access-application-cluster/web-ui-dashboard/" target="_blank" rel="noopener noreferrer">Kubernetes Dashboard</a> by downloading the credentials for your Kubernetes cluster and opening up a proxy to the cluster:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud container clusters get-credentials bookkeeper-gke-cluster </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --zone</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">us-central1-a </span><span class="token punctuation" style="color:#393A34">\</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  --project</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">your-project-name</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl proxy</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>By default, the proxy will be opened on port 8001. Now you can navigate to <a href="http://localhost:8001/ui" target="_blank" rel="noopener noreferrer">localhost:8001/ui</a> in your browser to access the dashboard. At first your GKE cluster will be empty, but that will change as you begin deploying.</p><p>When you create a cluster, your <code>kubectl</code> config in <code>~/.kube/config</code> (on MacOS and Linux) will be updated for you, so you probably won&#x27;t need to change your configuration. Nonetheless, you can ensure that <code>kubectl</code> can interact with your cluster by listing the nodes in the cluster:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get nodes</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>If <code>kubectl</code> is working with your cluster, you can proceed to deploy ZooKeeper and Bookies.</p><h3 class="anchor anchorWithStickyNavbar_mojV" id="zookeeper">ZooKeeper<a class="hash-link" href="#zookeeper" title="Direct link to heading">​</a></h3><p>You <em>must</em> deploy ZooKeeper as the first component, as it is a dependency for the others.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f zookeeper.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Wait until all three ZooKeeper server pods are up and have the status <code>Running</code>. You can check on the status of the ZooKeeper pods at any time:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods -l </span><span class="token assign-left variable" style="color:#36acaa">component</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">zookeeper</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">NAME      READY     STATUS             RESTARTS   AGE</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zk-0      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          18m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zk-1      </span><span class="token number" style="color:#36acaa">1</span><span class="token plain">/1       Running            </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">          17m</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">zk-2      </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">/1       Running            </span><span class="token number" style="color:#36acaa">6</span><span class="token plain">          15m</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>This step may take several minutes, as Kubernetes needs to download the Docker image on the VMs.</p><p>If you want to connect to one of the remote zookeeper server, you can use<a href="https://github.com/rgs1/zk_shell" target="_blank" rel="noopener noreferrer">zk-shell</a>, you need to forward a local port to the
remote zookeeper server:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl port-forward zk-0 </span><span class="token number" style="color:#36acaa">2181</span><span class="token plain">:2181</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ zk-shell localhost </span><span class="token number" style="color:#36acaa">2181</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="deploy-bookies">Deploy Bookies<a class="hash-link" href="#deploy-bookies" title="Direct link to heading">​</a></h3><p>Once ZooKeeper cluster is Running, you can then deploy the bookies. You can deploy the bookies either using a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/" target="_blank" rel="noopener noreferrer">DaemonSet</a> or a <a href="https://kubernetes.io/docs/concepts/workloads/controllers/statefulset/" target="_blank" rel="noopener noreferrer">StatefulSet</a>.</p><blockquote><p>NOTE: <em>DaemonSet</em> vs <em>StatefulSet</em></p><p>A <em>DaemonSet</em> ensures that all (or some) nodes run a pod of bookie instance. As nodes are added to the cluster, bookie pods are added automatically to them. As nodes are removed from the
cluster, those bookie pods are garbage collected. The bookies deployed in a DaemonSet stores data on the local disks on those nodes. So it doesn&#x27;t require any external storage for Persistent
Volumes.</p><p>A <em>StatefulSet</em> maintains a sticky identity for the pods that it runs and manages. It provides stable and unique network identifiers, and stable and persistent storage for each pod. The pods
are not interchangeable, the idenifiers for each pod are maintained across any rescheduling.</p><p>Which one to use? A <em>DaemonSet</em> is the easiest way to deploy a bookkeeper cluster, because it doesn&#x27;t require additional persistent volume provisioner and use local disks. BookKeeper manages
the data replication. It maintains the best latency property. However, it uses <code>hostIP</code> and <code>hostPort</code> for communications between pods. In some k8s platform (such as DC/OS), <code>hostIP</code> and
<code>hostPort</code> are not well supported. A <em>StatefulSet</em> is only practical when deploying in a cloud environment or any K8S installation that has persistent volumes available. Also be aware, latency
can be potentially higher when using persistent volumes, because there is usually built-in replication in the persistent volumes.</p></blockquote><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># deploy bookies in a daemon set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f bookkeeper.yaml</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># deploy bookies in a stateful set</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl apply -f bookkeeper.stateful.yaml</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>You can check on the status of the Bookie pods for these components either in the Kubernetes Dashboard or using <code>kubectl</code>:</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl get pods</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>While all BookKeeper pods is Running, by zk-shell you could find all available bookies under /ledgers/</p><p>You could also run a <a href="https://github.com/ivankelly/bookkeeper-tutorial/" target="_blank" rel="noopener noreferrer">bookkeeper tutorial</a> instance, which named as &#x27;dice&#x27; here, in this bookkeeper cluster.</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$﻿kubectl run -i --tty --attach dice --image</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">caiok/bookkeeper-tutorial --env </span><span class="token assign-left variable" style="color:#36acaa">ZOOKEEPER_SERVERS</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&quot;zk-0.zookeeper&quot;</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>An example output of Dice instance is like this:</p><div class="codeBlockContainer_I0IT language-aidl theme-code-block"><div class="codeBlockContent_wNvx aidl"><pre tabindex="0" class="prism-code language-aidl codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">➜ $ kubectl run -i --tty --attach dice --image=caiok/bookkeeper-tutorial --env ZOOKEEPER_SERVERS=&quot;zk-0.zookeeper&quot;          </span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">If you don&#x27;t see a command prompt, try pressing enter.</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 1, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 2, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 1, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 4, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 5, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 4, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 3, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 5, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 3, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 2, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 1, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 4, epoch = 5, leading</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Value = 2, epoch = 5, leading</span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><h3 class="anchor anchorWithStickyNavbar_mojV" id="un-deploy">Un-Deploy<a class="hash-link" href="#un-deploy" title="Direct link to heading">​</a></h3><p>Delete Demo dice instance</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$﻿kubectl delete deployment dice      </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Delete BookKeeper</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete -f bookkeeper.yaml    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Delete ZooKeeper</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ kubectl delete -f zookeeper.yaml    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div><p>Delete cluster</p><div class="codeBlockContainer_I0IT language-bash theme-code-block"><div class="codeBlockContent_wNvx bash"><pre tabindex="0" class="prism-code language-bash codeBlock_jd64 thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_mRuA"><span class="token-line" style="color:#393A34"><span class="token plain">$ gcloud container clusters delete bookkeeper-gke-cluster    </span><br></span></code></pre><button type="button" aria-label="Copy code to clipboard" class="copyButton_wuS7 clean-btn">Copy</button></div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><div class="pagination-nav__item"><a class="pagination-nav__link" href="/docs/4.10.0/deployment/dcos"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Deploying BookKeeper on DC/OS</div></a></div><div class="pagination-nav__item pagination-nav__item--next"><a class="pagination-nav__link" href="/docs/4.10.0/admin/bookies"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">BookKeeper administration</div></a></div></nav></div></div><div class="col col--3"><div class="tableOfContents_cNA8 thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#setup-on-google-container-engine" class="table-of-contents__link toc-highlight">Setup on Google Container Engine</a><ul><li><a href="#prerequisites" class="table-of-contents__link toc-highlight">Prerequisites</a></li><li><a href="#create-a-new-kubernetes-cluster" class="table-of-contents__link toc-highlight">Create a new Kubernetes cluster</a></li><li><a href="#dashboard" class="table-of-contents__link toc-highlight">Dashboard</a></li><li><a href="#zookeeper" class="table-of-contents__link toc-highlight">ZooKeeper</a></li><li><a href="#deploy-bookies" class="table-of-contents__link toc-highlight">Deploy Bookies</a></li><li><a href="#un-deploy" class="table-of-contents__link toc-highlight">Un-Deploy</a></li></ul></li></ul></div></div></div></div></main></div></div><footer class="footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="col footer__col"><div class="footer__title">Documentation</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/docs/overview">Overview</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/getting-started/installation">Getting started</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/deployment/manual">Deployment</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/admin/bookies">Administration</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/api/overview">API</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/security/overview">Security</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/development/protocol">Development</a></li><li class="footer__item"><a class="footer__link-item" href="/docs/reference/config">Reference</a></li></ul></div><div class="col footer__col"><div class="footer__title">Community</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/community/mailing-lists">Mailing lists</a></li><li class="footer__item"><a class="footer__link-item" href="/community/slack">Slack</a></li><li class="footer__item"><a href="https://github.com/apache/bookkeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Github<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://twitter.com/asfbookkeeper" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Twitter<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div><div class="col footer__col"><div class="footer__title">Project</div><ul class="footer__items"><li class="footer__item"><a class="footer__link-item" href="/project/who">Who are we?</a></li><li class="footer__item"><a class="footer__link-item" href="/project/bylaws">Bylaws</a></li><li class="footer__item"><a href="https://apache.org/licenses" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>License<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a class="footer__link-item" href="/project/privacy">Privacy policy</a></li><li class="footer__item"><a href="https://www.apache.org/foundation/sponsorship.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Sponsorship<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li><li class="footer__item"><a href="https://www.apache.org/foundation/thanks.html" target="_blank" rel="noopener noreferrer" class="footer__link-item"><span>Thanks<svg width="13.5" height="13.5" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_I5OW"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></span></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright"><footer class="footer">
        <div class="container">
          <div class="content has-text-centered">
            <p>
              Copyright &copy; 2016 - 2022 <a href="https://www.apache.org/">The Apache Software Foundation</a>,<br> licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, version 2.0</a>.
            </p>
            <p>
              Apache BookKeeper, BookKeeper®, Apache®, the Apache feature logo, and the Apache BookKeeper logo are either registered trademarks or trademarks of The Apache Software Foundation.
            </p>
          </div>
        </div>
      </footer>
      </div></div></div></footer></div>
<script src="/assets/js/runtime~main.2f35421b.js"></script>
<script src="/assets/js/main.61419cb6.js"></script>
</body>
</html>