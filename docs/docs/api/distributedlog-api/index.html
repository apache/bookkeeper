<!DOCTYPE html>
<html>
  <head>
    <title>Apache BookKeeper - DistributedLog</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/bookkeeper/css/normalize.css">
<link rel="stylesheet" href="/bookkeeper/css/tippy.css">
<link rel="stylesheet" href="/bookkeeper/css/style.css">

<link rel="shortcut icon" href="/bookkeeper/img/favicon.ico">

<script src="/bookkeeper/js/tippy.min.js"></script>

<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -100); };
  window.addEventListener("hashchange", shiftWindow);
  //window.addEventListener("pageshow", shiftWindow);
  function load() { if (window.location.hash) shiftWindow(); }
</script>

  </head>
  <body class="body">
    <main class="main">
      
<nav class="navbar">
  <div class="navbar-brand">
    <a class="navbar-item">
      <img src="/bookkeeper/img/bk-logo.png"> Apache BookKeeper
    </a>

    <div class="navbar-burger">
      <span></span>
      <span></span>
      <span></span>
    </div>
  </div>
  <div class="navbar-menu">
    <div class="navbar-start">
      <div class="navbar-item has-dropdown">
        <a class="navbar-link">
          Versions
        </a>

        <div class="navbar-dropdown">

        </div>
      </div>
    </div>
    <div class="navbar-end">
      <div class="navbar-item">
        <div class="field is-grouped">
          <p class="control">
            <a class="button">
              <span class="icon">
                <i class="fa fa-twitter"></i>
              </span>
              <span>Tweet</span>
            </a>
          </p>
          <p class="control">
            <a class="button is-primary">
              <span class="icon">
                <i class="fa fa-download"></i>
              </span>
              <span>Download</span>
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</nav>

      <div class="container bk-docs-container">
  <div class="columns">
    <div class="column is-2">
      <aside class="sidebar">
  
  <p>
    Getting started
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/installation">
      Installation
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/run-locally">
      Run bookies locally
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/concepts">
      Concepts and architecture
      </a>
    </li>
    
  </ul>
  
  <p>
    Deployment
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/manual">
      Manual deployment
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/dcos">
      BookKeeper on DC/OS
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/kubernetes">
      BookKeeper on Kubernetes
      </a>
    </li>
    
  </ul>
  
  <p>
    Administration
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/admin/bookies">
      BookKeeper administration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/autorecovery">
      Setting up AutoRecovery
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/metrics">
      Metric collection
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/geo-replication">
      Geo-replication
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/placement">
      Customized placement policies
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/perf">
      Performance tuning
      </a>
    </li>
    
  </ul>
  
  <p>
    API
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/api/overview">
      Overview
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/ledger-api">
      Ledger API
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/distributedlog-api">
      DistributedLog
      </a>
    </li>
    
  </ul>
  
  <p>
    Development
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/development/protocol">
      BookKeeper protocol
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/development/codebase">
      Codebase
      </a>
    </li>
    
  </ul>
  
  <p>
    Reference
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/reference/config">
      Configuration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/cli">
      Command-line tools
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/metrics">
      Metrics
      </a>
    </li>
    
  </ul>
  
</aside>

<!--
<aside class="menu">
  
  <p class="menu-label">
    Getting started
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/installation">
      Installation
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/run-locally">
      Run bookies locally
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/concepts">
      Concepts and architecture
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Deployment
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/manual">
      Manual deployment
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/dcos">
      BookKeeper on DC/OS
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/kubernetes">
      BookKeeper on Kubernetes
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Administration
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/admin/bookies">
      BookKeeper administration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/autorecovery">
      Setting up AutoRecovery
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/metrics">
      Metric collection
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/geo-replication">
      Geo-replication
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/placement">
      Customized placement policies
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/perf">
      Performance tuning
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    API
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/api/overview">
      Overview
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/ledger-api">
      Ledger API
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/distributedlog-api">
      DistributedLog
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Development
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/development/protocol">
      BookKeeper protocol
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/development/codebase">
      Codebase
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Reference
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/reference/config">
      Configuration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/cli">
      Command-line tools
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/metrics">
      Metrics
      </a>
    </li>
    
  </ul>
  
</aside>
-->

    </div>

    <div class="column is-8 bk-docs-block">
      <header class="docs-title">
        <nav class="level">
          <div class="level-left">
            <div class="level-item">
              <h1 class="title">DistributedLog</h1>
            </div>
          </div>
          
        </nav>

        <h2 class="subtitle">A higher-level API for managing BookKeeper entries</h2>
      </header>

      <hr />

      <div class="content is-medium">
        <section class="bk-docs-content">
          <blockquote>
  <p>DistributedLog began its life as a separate project under the Apache Foundation. It was merged into BookKeeper in 2017.</p>
</blockquote>

<p>The DistributedLog API is an easy-to-use interface for managing BookKeeper entries that enables you to use BookKeeper without needing to interact with <a href="../ledger-api">ledgers</a> directly.</p>

<p>DistributedLog (DL) maintains sequences of records in categories called <em>logs</em> (aka <em>log streams</em>). <em>Writers</em> append records to DL logs, while <em>readers</em> fetch and process those records.</p>

<h2 id="architecture">Architecture</h2>

<p>The diagram below illustrates how the DistributedLog API works with BookKeeper:</p>

<p><img src="/bookkeeper/img/distributedlog.png" alt="DistributedLog API" /></p>

<h2 id="logs">Logs</h2>

<p>A <em>log</em> in DistributedLog is an ordered, immutable sequence of <em>log records</em>.</p>

<p>The diagram below illustrates the anatomy of a log stream:</p>

<p><img src="/bookkeeper/img/logs.png" alt="DistributedLog log" /></p>

<h3 id="log-records">Log records</h3>

<p>Each log record is a sequence of bytes. Applications are responsible for serializing and deserializing byte sequences stored in log records.</p>

<p>Log records are written sequentially into a <em>log stream</em> and assigned with a a unique sequence number called a DLSN (<strong>D</strong>istributed<strong>L</strong>og <strong>S</strong>equence <strong>N</strong>umber).</p>

<p>In addition to a DLSN, applications can assign their own sequence number when constructing log records. Application-defined sequence numbers are known as <em>TransactionIDs</em> (or <em>txid</em>). Either a DLSN or a TransactionID can be used for positioning readers to start reading from a specific log record.</p>

<h3 id="log-segments">Log segments</h3>

<p>Each log is broken down into <em>log segments</em> that contain subsets of records. Log segments are distributed and stored in BookKeeper. DistributedLog rolls the log segments based on the configured <em>rolling policy</em>, which be either</p>

<ul>
  <li>a configurable period of time (such as every 2 hours), or</li>
  <li>a configurable maximum size (such as every 128 MB).</li>
</ul>

<p>The data in logs is divided up into equally sized log segments and distributed evenly across <span class="pop" id="bookie-popover">bookies</span>. This allows logs to scale beyond a size that would fit on a single server and spreads read traffic across the cluster.</p>

<h3 id="namespaces">Namespaces</h3>

<p>Log streams that belong to the same organization are typically categorized and managed under a <em>namespace</em>. DistributedLog namespaces essentially enable applications to locate log streams. Applications can perform the following actions under a namespace:</p>

<ul>
  <li>create streams</li>
  <li>delete streams</li>
  <li>truncate streams to a given sequence number (either a DLSN or a TransactionID)</li>
</ul>

<h2 id="writers">Writers</h2>

<p>Through the DistributedLog API, writers write data into logs of their choice. All records are appended into logs in order. The sequencing is performed by the writer, which means that there is only one active writer for a log at any given time.</p>

<p>DistributedLog guarantees correctness when two writers attempt to write to the same log when a network partition occurs using a <em>fencing</em> mechanism in the log segment store.</p>

<h3 id="write-proxy">Write Proxy</h3>

<p>Log writers are served and managed in a service tier called the <em>Write Proxy</em> (see the diagram <a href="#architecture">above</a>). The Write Proxy is used for accepting writes from a large number of clients.</p>

<h2 id="readers">Readers</h2>

<p>DistributedLog readers read records from logs of their choice, starting with a provided position. The provided position can be either a DLSN or a TransactionID.</p>

<p>Readers read records from logs in strict order. Different readers can read records from different positions in the same log.</p>

<p>Unlike other pub-sub systems, DistributedLog doesn’t record or manage readers’ positions. This means that tracking is the responsibility of applications, as different applications may have different requirements for tracking and coordinating positions. This is hard to get right with a single approach. Distributed databases, for example, might store reader positions along with SSTables, so they would resume applying transactions from the positions store in SSTables. Tracking reader positions could easily be done at the application level using various stores (such as ZooKeeper, the filesystem, or key-value stores).</p>

<h3 id="read-proxy">Read Proxy</h3>

<p>Log records can be cached in a service tier called the <em>Read Proxy</em> to serve a large number of readers. See the diagram <a href="#architecture">above</a>. The Read Proxy is the analogue of the <a href="#write-proxy">Write Proxy</a>.</p>

<h2 id="guarantees">Guarantees</h2>

<p>The DistributedLog API for BookKeeper provides a number of guarantees for applications:</p>

<ul>
  <li>Records written by a <a href="#writers">writer</a> to a <a href="#logs">log</a> are appended in the order in which they are written. If a record <strong>R1</strong> is written by the same writer as a record <strong>R2</strong>, <strong>R1</strong> will have a smaller sequence number than <strong>R2</strong>.</li>
  <li><a href="#readers">Readers</a> see <a href="#log-records">records</a> in the same order in which they are <a href="#writers">written</a> to the log.</li>
  <li>All records are persisted on disk by BookKeeper before acknowledgements, which guarantees durability.</li>
  <li>For a log with a replication factor of N, DistributedLog tolerates up to N-1 server failures without losing any records.</li>
</ul>

<h2 id="api">API</h2>

<p>The DistributedLog core library is written in Java and interacts with namespaces and logs directly.</p>

<h3 id="namespace-api">Namespace API</h3>

<p>A DL <a href="#namespace">namespace</a> is a collection of <a href="#log-streams">log streams</a>. Namespaces are identified on the basis of a <a href="https://en.wikipedia.org/wiki/Uniform_Resource_Identifier">URI</a>, which has this structure:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code>distributedlog-bk://&lt;domain-name&gt;/path/to/stream
</code></pre>
</div>

<p>Namespace URIs have three components:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Component</th>
      <th style="text-align: left">Structure</th>
      <th style="text-align: left">Meaning</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Scheme</td>
      <td style="text-align: left"><code class="highlighter-rouge">distributedlog-bk</code></td>
      <td style="text-align: left">Specifies that the URI is a DistributedLog/BookKeeper URI</td>
    </tr>
    <tr>
      <td style="text-align: left">Domain name</td>
      <td style="text-align: left">Host/port</td>
      <td style="text-align: left">The domain name that is used to talk to the BookKeeper storage backend (often a ZooKeeper domain)</td>
    </tr>
    <tr>
      <td style="text-align: left">Path</td>
      <td style="text-align: left"><code class="highlighter-rouge">/path/to/stream</code></td>
      <td style="text-align: left">Points to the location that stores logs. This could be a ZooKeeper <a href="https://zookeeper.apache.org/doc/current/zookeeperOver.html">znode</a>.</td>
    </tr>
  </tbody>
</table>

<h4 id="building-namespaces">Building namespaces</h4>

<p>Once you have a namespace URI, you can build a namespace instance, which will be used for operating streams. Use the <a href=""><code class="highlighter-rouge">DistributedLogNamespaceBuilder</code></a> to build the <a href=""><code class="highlighter-rouge">DistributedLogNamespace</code></a> object, passing in a <a href=""><code class="highlighter-rouge">DistributedLogConfiguration</code></a>, a URI, and optionally a stats logger and a feature provider.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DistributedLogConfiguration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DistributedLogConfiguration</span><span class="o">();</span>
<span class="n">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"distributedlog-bk://zookeeper-domain/path/to/stream"</span><span class="o">);</span>
<span class="n">DistributedLogNamespaceBuilder</span> <span class="n">builder</span> <span class="o">=</span> <span class="n">DistributedLogNamespaceBuilder</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">();</span>
<span class="n">DistributedLogNamespace</span> <span class="o">=</span> <span class="n">builder</span>
        <span class="o">.</span><span class="na">conf</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>           <span class="c1">// Configuration for the namespace</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>             <span class="c1">// URI for the namespace</span>
        <span class="o">.</span><span class="na">statsLogger</span><span class="o">(...)</span>     <span class="c1">// Stats logger for statistics</span>
        <span class="o">.</span><span class="na">featureProvider</span><span class="o">(...)</span> <span class="c1">// Feature provider for controlling features</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
</code></pre>
</div>

<h3 id="log-api">Log API</h3>

<h4 id="creating-logs">Creating logs</h4>

<p>You can create a log by calling the <code class="highlighter-rouge">createLog</code> method on a <a href=""><code class="highlighter-rouge">DistributedLogNamespace</code></a> object, passing in a name for the log. This creates the log under the namespace but does <em>not</em> return a handle for operating the log.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DistributedLogNamespace</span> <span class="n">namespace</span> <span class="o">=</span> <span class="cm">/* Create namespace */</span><span class="o">;</span>
<span class="k">try</span> <span class="o">{</span>
    <span class="n">namespace</span><span class="o">.</span><span class="na">createLog</span><span class="o">(</span><span class="s">"test-log"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">}</span>
    <span class="c1">// Handle the log creation exception</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="opening-logs">Opening logs</h4>

<p>A <a href=""><code class="highlighter-rouge">DistributedLogManager</code></a> handle will be returned when opening a log using the <code class="highlighter-rouge">openLog</code> function, which takes the name of the log. This handle can be used for writing records to or reading records from the log.</p>

<blockquote>
  <p>If the log doesn’t exist and <code class="highlighter-rouge">createStreamIfNotExists</code> is set to <code class="highlighter-rouge">true</code> in the configuration, the log will be created automatically when writing the first record.</p>
</blockquote>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DistributedLogConfiguration</span> <span class="n">conf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DistributedLogConfiguration</span><span class="o">();</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setCreateStreamIfNotExists</span><span class="o">(</span><span class="kc">true</span><span class="o">);</span>
<span class="n">DistributedLogNamespace</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">DistributedLogNamespace</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">conf</span><span class="o">(</span><span class="n">conf</span><span class="o">)</span>
        <span class="c1">// Other builder attributes</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="n">DistributedLogManager</span> <span class="n">logManager</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="na">openLog</span><span class="o">(</span><span class="s">"test-log"</span><span class="o">);</span>
</code></pre>
</div>

<p>Sometimes, applications may open a log with a different configuration from the enclosing namespace. This can be done using the same <code class="highlighter-rouge">openLog</code> method:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="c1">// Namespace configuration</span>
<span class="n">DistributedLogConfiguration</span> <span class="n">namespaceConf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DistributedLogConfiguration</span><span class="o">();</span>
<span class="n">conf</span><span class="o">.</span><span class="na">setRetentionPeriodHours</span><span class="o">(</span><span class="mi">24</span><span class="o">);</span>
<span class="n">URI</span> <span class="n">uri</span> <span class="o">=</span> <span class="n">URI</span><span class="o">.</span><span class="na">create</span><span class="o">(</span><span class="s">"distributedlog-bk://zookeeper-domain/path/to/stream"</span><span class="o">);</span>
<span class="n">DistributedLogNamespace</span> <span class="n">namespace</span> <span class="o">=</span> <span class="n">DistributedLogNamespace</span><span class="o">.</span><span class="na">newBuilder</span><span class="o">()</span>
        <span class="o">.</span><span class="na">conf</span><span class="o">(</span><span class="n">namespaceConf</span><span class="o">)</span>
        <span class="o">.</span><span class="na">uri</span><span class="o">(</span><span class="n">uri</span><span class="o">)</span>
        <span class="c1">// Other builder attributes</span>
        <span class="o">.</span><span class="na">build</span><span class="o">();</span>
<span class="c1">// Log-specific configuration</span>
<span class="n">DistributedLogConfiguration</span> <span class="n">logConf</span> <span class="o">=</span> <span class="k">new</span> <span class="n">DistributedLogConfiguration</span><span class="o">();</span>
<span class="n">logConf</span><span class="o">.</span><span class="na">setRetentionPeriodHours</span><span class="o">(</span><span class="mi">12</span><span class="o">);</span>
<span class="n">DistributedLogManager</span> <span class="n">logManager</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="na">openLog</span><span class="o">(</span>
        <span class="s">"test-log"</span><span class="o">,</span>
        <span class="n">Optional</span><span class="o">.</span><span class="na">of</span><span class="o">(</span><span class="n">logConf</span><span class="o">),</span>
        <span class="n">Optional</span><span class="o">.</span><span class="na">absent</span><span class="o">()</span>
<span class="o">);</span>
</code></pre>
</div>

<h4 id="deleting-logs">Deleting logs</h4>

<p>The <a href=""><code class="highlighter-rouge">DistributedLogNamespace</code></a> class provides <code class="highlighter-rouge">deleteLog</code> function that can be used to delete logs. When you delete a lot, the client library will attempt to acquire a lock on the log before deletion. If the log is being written to by an active writer, deletion will fail (as the other writer currently holds the lock).</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">try</span> <span class="o">{</span>
    <span class="n">namespace</span><span class="o">.</span><span class="na">deleteLog</span><span class="o">(</span><span class="s">"test-log"</span><span class="o">);</span>
<span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">IOException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
    <span class="c1">// Handle exception</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="checking-for-the-existence-of-a-log">Checking for the existence of a log</h4>

<p>Applications can check whether a log exists by calling the <code class="highlighter-rouge">logExists</code> function.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="o">(</span><span class="n">namespace</span><span class="o">.</span><span class="na">logExists</span><span class="o">(</span><span class="s">"test-log"</span><span class="o">))</span> <span class="o">{</span>
  <span class="c1">// Perform some action when the log exists</span>
<span class="o">}</span> <span class="k">else</span> <span class="o">{</span>
  <span class="c1">// Perform some action when the log doesn't exist</span>
<span class="o">}</span>
</code></pre>
</div>

<h4 id="listing-logs">Listing logs</h4>

<p>Applications can retrieve a list of all logs under a namespace using the <code class="highlighter-rouge">getLogs</code> function.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">Iterator</span><span class="o">&lt;</span><span class="n">String</span><span class="o">&gt;</span> <span class="n">logs</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="na">getLogs</span><span class="o">();</span>
<span class="k">while</span> <span class="o">(</span><span class="n">logs</span><span class="o">.</span><span class="na">hasNext</span><span class="o">())</span> <span class="o">{</span>
  <span class="n">String</span> <span class="n">logName</span> <span class="o">=</span> <span class="n">logs</span><span class="o">.</span><span class="na">next</span><span class="o">();</span>
  <span class="c1">// Do something with the log name, such as print</span>
<span class="o">}</span>
</code></pre>
</div>

<h3 id="writer-api">Writer API</h3>

<p>You can write to DistributedLog logs either <a href="#writing-to-logs-synchronously">synchronously</a> using the <a href=""><code class="highlighter-rouge">LogWriter</code></a> class or <a href="#writing-to-logs-asynchronously">asynchronously</a> using the <a href=""><code class="highlighter-rouge">AsyncLogWriter</code></a> class.</p>

<h4 id="writing-to-logs-synchronously">Writing to logs synchronously</h4>

<p>To write records to a log synchronously, you need to instantiate a <a href=""><code class="highlighter-rouge">LogWriter</code></a> object using a <a href=""><code class="highlighter-rouge">DistributedLogManager</code></a>. Here’s an example:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">DistributedLogNamespace</span> <span class="n">namespace</span> <span class="o">=</span> <span class="cm">/* Some namespace object */</span><span class="o">;</span>
<span class="n">DistributedLogManager</span> <span class="n">logManager</span> <span class="o">=</span> <span class="n">namespace</span><span class="o">.</span><span class="na">openLog</span><span class="o">(</span><span class="s">"test-log"</span><span class="o">);</span>
<span class="n">LogWriter</span> <span class="n">writer</span> <span class="o">=</span> <span class="n">logManager</span><span class="o">.</span><span class="na">startLogSegmentNonPartitioned</span><span class="o">();</span>
</code></pre>
</div>

<blockquote>
  <p>The DistributedLog library enforces single-writer semantics by deploying a ZooKeeper locking mechanism. If there is only one active writer, subsequent calls to <code class="highlighter-rouge">startLogSegmentNonPartitioned</code> will fail with an <a href=""><code class="highlighter-rouge">OwnershipAcquireFailedException</code></a>.</p>
</blockquote>

<p>Log records represent the data written to a log stream. Each log record is associated with an application-defined <a href="#log-records">TransactionID</a>. This ID must be non decreasing or else writing a record will be rejected with <a href=""><code class="highlighter-rouge">TransactionIdOutOfOrderException</code></a>. The application is allowed to bypass the TransactionID sanity checking by setting <code class="highlighter-rouge">maxIdSanityCheck</code> to <code class="highlighter-rouge">false</code> in the configuration. System time and atomic numbers are good candidates for TransactionID.</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="kt">long</span> <span class="n">txid</span> <span class="o">=</span> <span class="mi">1L</span><span class="o">;</span>
<span class="kt">byte</span><span class="o">[]</span> <span class="n">data</span> <span class="o">=</span> <span class="s">"some byte array"</span><span class="o">.</span><span class="na">getBytes</span><span class="o">();</span>
<span class="n">LogRecord</span> <span class="n">record</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LogRecord</span><span class="o">(</span><span class="n">txid</span><span class="o">,</span> <span class="n">data</span><span class="o">);</span>
</code></pre>
</div>

<h4 id="writing-to-logs-asynchronously">Writing to logs asynchronously</h4>

<h3 id="reader-api">Reader API</h3>

<h4 id="reading-from-logs-synchronously">Reading from logs synchronously</h4>

<h4 id="reading-from-logs-asynchronously">Reading from logs asynchronously</h4>

        </section>

        
      </div>
    </div>

    <div class="column is-2">
      
      <div class="toc">
  <h2 class="title">DistributedLog</h2>
  <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#architecture">Architecture</a></li>
<li class="toc-entry toc-h2"><a href="#logs">Logs</a></li>
<li class="toc-entry toc-h3"><a href="#log-records">Log records</a></li>
<li class="toc-entry toc-h3"><a href="#log-segments">Log segments</a></li>
<li class="toc-entry toc-h3"><a href="#namespaces">Namespaces</a></li>
<li class="toc-entry toc-h2"><a href="#writers">Writers</a></li>
<li class="toc-entry toc-h3"><a href="#write-proxy">Write Proxy</a></li>
<li class="toc-entry toc-h2"><a href="#readers">Readers</a></li>
<li class="toc-entry toc-h3"><a href="#read-proxy">Read Proxy</a></li>
<li class="toc-entry toc-h2"><a href="#guarantees">Guarantees</a></li>
<li class="toc-entry toc-h2"><a href="#api">API</a></li>
<li class="toc-entry toc-h3"><a href="#namespace-api">Namespace API</a></li>
<li class="toc-entry toc-h4"><a href="#building-namespaces">Building namespaces</a></li>
<li class="toc-entry toc-h3"><a href="#log-api">Log API</a></li>
<li class="toc-entry toc-h4"><a href="#creating-logs">Creating logs</a></li>
<li class="toc-entry toc-h4"><a href="#opening-logs">Opening logs</a></li>
<li class="toc-entry toc-h4"><a href="#deleting-logs">Deleting logs</a></li>
<li class="toc-entry toc-h4"><a href="#checking-for-the-existence-of-a-log">Checking for the existence of a log</a></li>
<li class="toc-entry toc-h4"><a href="#listing-logs">Listing logs</a></li>
<li class="toc-entry toc-h3"><a href="#writer-api">Writer API</a></li>
<li class="toc-entry toc-h4"><a href="#writing-to-logs-synchronously">Writing to logs synchronously</a></li>
<li class="toc-entry toc-h4"><a href="#writing-to-logs-asynchronously">Writing to logs asynchronously</a></li>
<li class="toc-entry toc-h3"><a href="#reader-api">Reader API</a></li>
<li class="toc-entry toc-h4"><a href="#reading-from-logs-synchronously">Reading from logs synchronously</a></li>
<li class="toc-entry toc-h4"><a href="#reading-from-logs-asynchronously">Reading from logs asynchronously</a></li>
</ul>
</div>

      
    </div>
  </div>
</div>



<div id="entry-popover-html" class="popover-template">
  <p>An entry is a sequence of bytes written to a BookKeeper ledger.</p>

</div>

<div id="ledger-popover-html" class="popover-template">
  <p>A ledger is a sequence of entries written to BookKeeper. Entries are written sequentially to ledgers and at most once, giving ledgers append-only semantics.</p>

</div>

<div id="bookie-popover-html" class="popover-template">
  <p>A bookie is an individial BookKeeper storage server.</p>

<p>Bookies store the content of ledgers and act as a distributed ensemble.</p>

</div>

<div id="striping-popover-html" class="popover-template">
  <p>Striping is the process of distributing BookKeeper ledgers to sub-groups of bookies rather than to all bookies in a BookKeeper ensemble. Striping is essential to ensuring fast performance.</p>

</div>

<div id="journal-popover-html" class="popover-template">
  <p>A journal file stores BookKeeper transaction logs.</p>

</div>


<script type="text/javascript">

tippy('#entry-popover', {
  html: '#entry-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#ledger-popover', {
  html: '#ledger-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#bookie-popover', {
  html: '#bookie-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#striping-popover', {
  html: '#striping-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#journal-popover', {
  html: '#journal-popover-html',
  arrow: true,
  animation: 'fade'
});

</script>


    </main>

    <footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        Copyright &copy; 2016 - 2017 <a href="https://www.apache.org/">The Apache Software Foundation</a>,<br /> licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, version 2.0</a>.
      </p>
    </div>
  </div>
</footer>

  </body>

  <script src="/bookkeeper/js/app.js"></script>

</html>
