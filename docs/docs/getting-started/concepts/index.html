<!DOCTYPE html>
<html>
  <head>
    <title>Apache BookKeeper - BookKeeper concepts and architecture</title>

<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">

<link rel="stylesheet" href="/bookkeeper/css/normalize.css">
<link rel="stylesheet" href="/bookkeeper/css/tippy.css">
<link rel="stylesheet" href="/bookkeeper/css/style.css">

<link rel="shortcut icon" href="/bookkeeper/img/favicon.ico">

<script src="/bookkeeper/js/tippy.min.js"></script>

<script type="text/javascript">
  var shiftWindow = function() { scrollBy(0, -100); };
  window.addEventListener("hashchange", shiftWindow);
  //window.addEventListener("pageshow", shiftWindow);
  function load() { if (window.location.hash) shiftWindow(); }
</script>

  </head>
  <body class="body">
    <main class="main">
      
<nav class="nav has-shadow bk-navbar">
  <div class="container">
    <div class="nav-left bk-brand">
      <a class="nav-item" href="/bookkeeper/">
        <img src="/bookkeeper/img/bk-logo.png" alt="Apache BookKeeper">
        <h3>Apache BookKeeper</h3>
      </a>
    </div>

    <div class="nav-right nav-menu">
      <a class="nav-item is-tab" href="/bookkeeper/docs">
        Docs
      </a>

      <a class="nav-item is-tab" href="/bookkeeper/api">
        Javadoc
      </a>

      <a class="nav-item is-tab" href="https://github.com/apache/bookkeeper">
        <span class="icon is-medium">
          <i class="fa fa-github"></i>
        </span>
      </a>
      <a class="nav-item" href="https://stackoverflow.com/search?q=apache+bookkeeper">
        <span class="icon is-medium">
          <i class="fa fa-stack-overflow"></i>
        </span>
      </a>

      <div class="nav-item is-tab">
        <div class="field is-grouped">
          <p class="control">
            <a class="button is-primary" href="/bookkeeper/docs/getting-started/installation">
              <span class="icon">
                <i class="fa fa-download"></i>
              </span>
              <span>Get started</span>
            </a>
          </p>
        </div>
      </div>
    </div>
  </div>
</nav>


      <div class="container bk-docs-container">
  <div class="columns">
    <div class="column is-2">
      <aside class="sidebar">
  
  <p>
    Getting started
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/installation">
      Installation
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/run-locally">
      Run bookies locally
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/concepts">
      Concepts and architecture
      </a>
    </li>
    
  </ul>
  
  <p>
    Deployment
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/manual">
      Manual deployment
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/dcos">
      BookKeeper on DC/OS
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/kubernetes">
      BookKeeper on Kubernetes
      </a>
    </li>
    
  </ul>
  
  <p>
    Administration
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/admin/bookies">
      BookKeeper administration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/autorecovery">
      Setting up AutoRecovery
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/metrics">
      Metric collection
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/geo-replication">
      Geo-replication
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/placement">
      Customized placement policies
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/perf">
      Performance tuning
      </a>
    </li>
    
  </ul>
  
  <p>
    API
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/api/overview">
      Overview
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/ledger-api">
      Ledger API
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/distributedlog-api">
      DistributedLog
      </a>
    </li>
    
  </ul>
  
  <p>
    Development
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/development/protocol">
      BookKeeper protocol
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/development/codebase">
      Codebase
      </a>
    </li>
    
  </ul>
  
  <p>
    Reference
  </p>
  <ul class="sidebar-items">
    
    
    <li>
      <a href="/bookkeeper/docs/reference/config">
      Configuration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/cli">
      Command-line tools
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/metrics">
      Metrics
      </a>
    </li>
    
  </ul>
  
</aside>

<!--
<aside class="menu">
  
  <p class="menu-label">
    Getting started
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/installation">
      Installation
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/run-locally">
      Run bookies locally
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/getting-started/concepts">
      Concepts and architecture
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Deployment
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/manual">
      Manual deployment
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/dcos">
      BookKeeper on DC/OS
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/deployment/kubernetes">
      BookKeeper on Kubernetes
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Administration
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/admin/bookies">
      BookKeeper administration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/autorecovery">
      Setting up AutoRecovery
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/metrics">
      Metric collection
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/geo-replication">
      Geo-replication
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/placement">
      Customized placement policies
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/admin/perf">
      Performance tuning
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    API
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/api/overview">
      Overview
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/ledger-api">
      Ledger API
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/api/distributedlog-api">
      DistributedLog
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Development
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/development/protocol">
      BookKeeper protocol
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/development/codebase">
      Codebase
      </a>
    </li>
    
  </ul>
  
  <p class="menu-label">
    Reference
  </p>
  <ul class="menu-list">
    
    
    <li>
      <a href="/bookkeeper/docs/reference/config">
      Configuration
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/cli">
      Command-line tools
      </a>
    </li>
    
    
    <li>
      <a href="/bookkeeper/docs/reference/metrics">
      Metrics
      </a>
    </li>
    
  </ul>
  
</aside>
-->

    </div>

    <div class="column is-8 bk-docs-block">
      <header class="docs-title">
        <nav class="level">
          <div class="level-left">
            <div class="level-item">
              <h1 class="title">BookKeeper concepts and architecture</h1>
            </div>
          </div>
          
        </nav>

        <h2 class="subtitle">What drives BookKeeper and how it's built</h2>
      </header>

      <hr />

      <div class="content is-medium">
        <section class="bk-docs-content">
          <p>BookKeeper is a service used for persistent storage of log streams of records. BookKeeper replicates stored records across multiple servers.</p>

<h2 id="basic-terms">Basic terms</h2>

<p>In BookKeeper:</p>

<ul>
  <li>each unit of a log is an <a href="#entries"><em>entry</em></a> (aka record)</li>
  <li>streams of log entries are called <a href="#ledgers"><em>ledgers</em></a></li>
  <li>individual servers storing ledgers of entries are called <a href="#bookies"><em>bookies</em></a></li>
</ul>

<p>BookKeeper is designed to be reliable and resilient to a wide variety of failures. Bookies can crash, corrupt data, or discard data, but as long as there are enough bookies behaving correctly in the cluster the service as a whole will behave correctly.</p>

<h2 id="entries">Entries</h2>

<p>BookKeeper <em>entries</em> are sequences of bytes that are written to <a href="#ledgers">ledgers</a>. Each entry has the following fields:</p>

<table>
  <thead>
    <tr>
      <th style="text-align: left">Field</th>
      <th style="text-align: left">Java type</th>
      <th style="text-align: left">Description</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td style="text-align: left">Ledger number</td>
      <td style="text-align: left"><code class="highlighter-rouge">long</code></td>
      <td style="text-align: left">The ID of the ledger to which the entry has been written</td>
    </tr>
    <tr>
      <td style="text-align: left">Entry number</td>
      <td style="text-align: left"><code class="highlighter-rouge">long</code></td>
      <td style="text-align: left">The unique ID of the entry</td>
    </tr>
    <tr>
      <td style="text-align: left">Last confirmed (LC)</td>
      <td style="text-align: left"><code class="highlighter-rouge">long</code></td>
      <td style="text-align: left">The ID of the last recorded entry</td>
    </tr>
    <tr>
      <td style="text-align: left">Data</td>
      <td style="text-align: left"><code class="highlighter-rouge">byte[]</code></td>
      <td style="text-align: left">The entry’s data (written by the client application)</td>
    </tr>
    <tr>
      <td style="text-align: left">Authentication code</td>
      <td style="text-align: left"><code class="highlighter-rouge">byte[]</code></td>
      <td style="text-align: left">The message auth code, which includes <em>all</em> other fields in the entry</td>
    </tr>
  </tbody>
</table>

<blockquote>
  <p>Entries contain the actual data written to ledgers, along with some important metadata.</p>
</blockquote>

<h2 id="ledgers">Ledgers</h2>

<p>Ledgers are sequences of entries, while each entry is a sequence of bytes. Entries are written sequentially to a ledger and at most once. Consequently, ledgers have <em>append-only</em> semantics.</p>

<blockquote>
  <p>Ledgers are the basic unit of storage in BookKeeper.</p>
</blockquote>

<h2 id="clients">Clients</h2>

<p>BookKeeper clients execute operations on ledgers, such as creating and writing ledgers.</p>

<p>At a high level, a bookkeeper client receives entries from a client application and stores it to sets of bookies, and there are a few advantages in having such a service:</p>

<p>We can use hardware that is optimized for such a service. We currently believe that such a system has to be optimized only for disk I/O;
We can have a pool of servers implementing such a log system, and shared among a number of servers;
We can have a higher degree of replication with such a pool, which makes sense if the hardware necessary for it is cheaper compared to the one the application uses.</p>

<blockquote>
  <p>BookKeeper clients create and write data to ledgers.</p>
</blockquote>

<h2 id="bookies">Bookies</h2>

<p>A bookie is an individual BookKeeper storage server. Bookies store the content of ledgers. For any given ledger L, we call an ensemble the group of bookies storing the content of L. For performance, we store on each bookie of an ensemble only a fragment of a ledger. That is, we stripe when writing entries to a ledger such that each entry is written to sub-group of bookies of the ensemble.</p>

<blockquote>
  <p>Bookies are servers that handle ledgers.</p>
</blockquote>

<h3 id="motivation">Motivation</h3>

<p>The initial motivation for BookKeeper comes was the <a href="https://wiki.apache.org/hadoop/NameNode">NameNode</a> in the <a href="https://wiki.apache.org/hadoop/HDFS">Hadoop Distributed File System</a> (HDFS).</p>

<p>Namenodes log operations in a reliable fashion so that recovery is possible in the case of crashes. We have found the applications for BookKeeper extend far beyond HDFS, however. Essentially, any application that requires an append storage can replace their implementations with BookKeeper. BookKeeper has the advantage of writing efficiently, replicating for fault tolerance, and scaling throughput with the number of servers through striping.</p>

<h2 id="metadata-storage-service">Metadata storage service</h2>

<p>BookKeeper requires a metadata storage service to store information related to <a href="#ledgers">ledgers</a> and available bookies. We currently use ZooKeeper for such a task.</p>

<h2 id="data-management-in-bookies">Data management in bookies</h2>

<p>Bookies manage data in a <a href="https://en.wikipedia.org/wiki/Log-structured_file_system">log-structured</a> way, which is implemented using three types of files: <a href="#journals">journals</a>, <a href="#entry-logs">entry logs</a>, and <a href="#index-files">index files</a>.</p>

<h3 id="journals">Journals</h3>

<p>A journal file contains the BookKeeper transaction logs. Before any update takes place, a bookie ensures that a transaction describing the update is written to non-volatile storage. A new journal file is created once the bookie starts or the older journal file reaches the journal file size threshold.</p>

<h3 id="entry-logs">Entry logs</h3>

<p>An entry log file manages the written entries received from BookKeeper clients. Entries from different ledgers are aggregated and written sequentially, while their offsets are kept as pointers in LedgerCache for fast lookup. A new entry log file is created once the bookie starts or the older entry log file reaches the entry log size threshold. Old entry log files are removed by the Garbage Collector Thread once they are not associated with any active ledger.</p>

<h4 id="log-device">Log device</h4>

<h3 id="index-files">Index files</h3>

<p>An index file is created for each ledger, which comprises a header and several fixed-length index pages, recording the offsets of data stored in entry log files.</p>

<p>Since updating index files would introduce random disk I/O, for performance reasons, index files are updated lazily by a Sync Thread running in the background. Before index pages are persisted to disk, they are gathered in LedgerCache for lookup.</p>

<h3 id="ledger-cache">Ledger cache</h3>

<p>A memory pool caches ledger index pages, which more efficiently manage disk head scheduling.</p>

<h4 id="ledger-device">Ledger device</h4>

<h3 id="data-flush">Data flush</h3>

<p>Ledger index pages are flushed to index files in the following two cases:</p>

<p>LedgerCache memory reaches its limit. There is no more space available to hold newer index pages. Dirty index pages will be evicted from LedgerCache and persisted to index files.
A background thread Sync Thread is responsible for flushing index pages from LedgerCache to index files periodically.
Besides flushing index pages, Sync Thread is responsible for rolling journal files in case that journal files use too much disk space.</p>

<p>The data flush flow in Sync Thread is as follows:</p>

<p>Records a LastLogMark in memory. The LastLogMark contains two parts: first one is txnLogId (file id of a journal) and the second one is txnLogPos (offset in a journal). The LastLogMark indicates that those entries before it have been persisted to both index and entry log files.
Flushes dirty index pages from LedgerCache to index file, and flushes entry log files to ensure all buffered entries in entry log files are persisted to disk.
Ideally, a bookie just needs to flush index pages and entry log files that contains entries before LastLogMark. There is no such information in LedgerCache and Entry Log mapping to journal files, though. Consequently, the thread flushes LedgerCache and Entry Log entirely here, and may flush entries after the LastLogMark. Flushing more is not a problem, though, just redundant.
Persists LastLogMark to disk, which means entries added before LastLogMark whose entry data and index page were also persisted to disk. It is the time to safely remove journal files created earlier than txnLogId.
If the bookie has crashed before persisting LastLogMark to disk, it still has journal files containing entries for which index pages may not have been persisted. Consequently, when this bookie restarts, it inspects journal files to restore those entries; data isn’t lost.
Using the above data flush mechanism, it is safe for the Sync Thread to skip data flushing when the bookie shuts down. However, in Entry Logger, it uses BufferedChannel to write entries in batches and there might be data buffered in BufferedChannel upon a shut down. The bookie needs to ensure Entry Logger flushes its buffered data during shutting down. Otherwise, Entry Log files become corrupted with partial entries.</p>

<p>As described above, EntryLogger#flush is invoked in the following two cases:</p>
<ul>
  <li>in Sync Thread : used to ensure entries added before LastLogMark are persisted to disk.</li>
  <li>in ShutDown : used to ensure its buffered data persisted to disk to avoid data corruption with partial entries.</li>
</ul>

<h3 id="data-compaction">Data compaction</h3>

<p>In bookie server, entries of different ledgers are interleaved in entry log files. A bookie server runs a Garbage Collector thread to delete un-associated entry log files to reclaim disk space. If a given entry log file contains entries from a ledger that has not been deleted, then the entry log file would never be removed and the occupied disk space never reclaimed. In order to avoid such a case, a bookie server compacts entry log files in Garbage Collector thread to reclaim disk space.</p>

<p>There are two kinds of compaction running with different frequency, which are Minor Compaction and Major Compaction. The differences of Minor Compaction and Major Compaction are just their threshold value and compaction interval.</p>

<p>Threshold : Size percentage of an entry log file occupied by those undeleted ledgers. Default minor compaction threshold is 0.2, while major compaction threshold is 0.8.
Interval : How long to run the compaction. Default minor compaction is 1 hour, while major compaction threshold is 1 day.
NOTE: if either Threshold or Interval is set to less than or equal to zero, then compaction is disabled.</p>

<p>The data compaction flow in Garbage Collector Thread is as follows:</p>

<p>Garbage Collector thread scans entry log files to get their entry log metadata, which records a list of ledgers comprising an entry log and their corresponding percentages.
With the normal garbage collection flow, once the bookie determines that a ledger has been deleted, the ledger will be removed from the entry log metadata and the size of the entry log reduced.
If the remaining size of an entry log file reaches a specified threshold, the entries of active ledgers in the entry log will be copied to a new entry log file.
Once all valid entries have been copied, the old entry log file is deleted.</p>

<h2 id="zookeeper-metadata">ZooKeeper metadata</h2>

<p>BookKeeper requires a ZooKeeper installation for storing <a href="#ledger">ledger</a> metadata. Whenever you construct a <a href="/javadoc/org/apache/bookkeeper/client/BookKeeper"><code class="highlighter-rouge">BookKeeper</code></a> client object, you need to pass a list of ZooKeeper servers as a parameter to the constructor, like this:</p>

<div class="language-java highlighter-rouge"><pre class="highlight"><code><span class="n">String</span> <span class="n">zkConnectionString</span> <span class="o">=</span> <span class="s">"127.0.0.1:2181"</span><span class="o">;</span>
<span class="n">BookKeeper</span> <span class="n">bkClient</span> <span class="o">=</span> <span class="k">new</span> <span class="n">BookKeeper</span><span class="o">(</span><span class="n">zkConnectionString</span><span class="o">);</span>
</code></pre>
</div>

<blockquote>
  <p>For more info on using the BookKeeper Java client, see <a href="../../api/ledger-api#the-java-ledger-api-client">this guide</a>.</p>
</blockquote>

<h2 id="ledger-manager">Ledger manager</h2>

<p>A <em>ledger manager</em> handles ledgers’ metadata (which is stored in ZooKeeper). BookKeeper offers two types of ledger managers: the <a href="#flat-ledger-manager">flat ledger manager</a> and the <a href="#hierarchical-ledger-manager">hierarchical ledger manager</a>. Both ledger managers extend the <a href="/javadoc/org/apache/bookkeeper/meta/AbstractZkLedgerManager"><code class="highlighter-rouge">AbstractZkLedgerManager</code></a> abstract class.</p>

<blockquote>
  <h4 id="use-the-flat-ledger-manager-in-most-cases">Use the flat ledger manager in most cases</h4>
  <p>The flat ledger manager is the default and is recommended for nearly all use cases. The hierarchical ledger manager is better suited only for managing very large numbers of BookKeeper ledgers (&gt; 50,000).</p>
</blockquote>

<h3 id="flat-ledger-manager">Flat ledger manager</h3>

<p>The <em>flat ledger manager</em>, implemented in the <a href="/javadoc/org/apache/bookkeeper/meta/FlatLedgerManager.html"><code class="highlighter-rouge">FlatLedgerManager</code></a> class, stores all ledgers’ metadata in child nodes of a single ZooKeeper path. The flat ledger manager creates <a href="https://zookeeper.apache.org/doc/trunk/zookeeperProgrammers.html#Sequence+Nodes+--+Unique+Naming">sequential nodes</a> to ensure the uniqueness of the ledger ID and prefixes all nodes with <code class="highlighter-rouge">L</code>. Bookie servers manage their own active ledgers in a hash map so that it’s easy to find which ledgers have been deleted from ZooKeeper and then garbage collect them.</p>

<p>The flat ledger manager’s garbage collection follow proceeds as follows:</p>

<ul>
  <li>All existing ledgers are fetched from ZooKeeper (<code class="highlighter-rouge">zkActiveLedgers</code>)</li>
  <li>All ledgers currently active within the bookie are fetched (<code class="highlighter-rouge">bkActiveLedgers</code>)</li>
  <li>The currently actively ledgers are looped through to determine which ledgers don’t currently exist in ZooKeeper. Those are then garbage collected.</li>
  <li>The <em>hierarchical ledger manager</em> stores ledgers’ metadata in two-level <a href="https://zookeeper.apache.org/doc/current/zookeeperOver.html#Nodes+and+ephemeral+nodes">znodes</a>.</li>
</ul>

<h3 id="hierarchical-ledger-manager">Hierarchical ledger manager</h3>

<p>The <em>hierarchical ledger manager</em>, implemented in the <a href="/javadoc/org/apache/bookkeeper/meta/HierarchicalLedgerManager"><code class="highlighter-rouge">HierarchicalLedgerManager</code></a> class, first obtains a global unique ID from ZooKeeper using an <a href="https://zookeeper.apache.org/doc/current/api/org/apache/zookeeper/CreateMode.html#EPHEMERAL_SEQUENTIAL"><code class="highlighter-rouge">EPHEMERAL_SEQUENTIAL</code></a> znode. Since ZooKeeper’s sequence counter has a format of <code class="highlighter-rouge">%10d</code> (10 digits with 0 padding, for example <code class="highlighter-rouge">&lt;path&gt;0000000001</code>), the hierarchical ledger manager splits the generated ID into 3 parts:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>level1 <span class="o">(</span>2 digits<span class="o">)}{</span>level2 <span class="o">(</span>4 digits<span class="o">)}{</span>level3 <span class="o">(</span>4 digits<span class="o">)}</span>
</code></pre>
</div>

<p>These three parts are used to form the actual ledger node path to store ledger metadata:</p>

<div class="language-shell highlighter-rouge"><pre class="highlight"><code><span class="o">{</span>ledgers_root_path<span class="o">}</span>/<span class="o">{</span>level1<span class="o">}</span>/<span class="o">{</span>level2<span class="o">}</span>/L<span class="o">{</span>level3<span class="o">}</span>
</code></pre>
</div>

<p>For example, ledger 0000000001 is split into three parts, 00, 0000, and 00001, and stored in znode <code class="highlighter-rouge">/{ledgers_root_path}/00/0000/L0001</code>. Each znode could have as many 10,000 ledgers, which avoids the problem of the child list being larger than the maximum ZooKeeper packet size (which is the <a href="https://issues.apache.org/jira/browse/BOOKKEEPER-39">limitation</a> that initially prompted the creation of the hierarchical ledger manager).</p>

        </section>

        
        <nav class="pagination is-centered">
          
          <a class="pagination-previous" href="/docs/getting-started/run-locally">Previous</a>
          
          
          <a class="pagination-next" href="/docs/applications/java-client">Next</a>
          
          <ul class="pagination-list"></ul>
        </nav>
        
      </div>
    </div>

    <div class="column is-2">
      
      <div class="toc">
  <h2 class="title">BookKeeper concepts and architecture</h2>
  <ul class="section-nav">
<li class="toc-entry toc-h2"><a href="#basic-terms">Basic terms</a></li>
<li class="toc-entry toc-h2"><a href="#entries">Entries</a></li>
<li class="toc-entry toc-h2"><a href="#ledgers">Ledgers</a></li>
<li class="toc-entry toc-h2"><a href="#clients">Clients</a></li>
<li class="toc-entry toc-h2"><a href="#bookies">Bookies</a></li>
<li class="toc-entry toc-h3"><a href="#motivation">Motivation</a></li>
<li class="toc-entry toc-h2"><a href="#metadata-storage-service">Metadata storage service</a></li>
<li class="toc-entry toc-h2"><a href="#data-management-in-bookies">Data management in bookies</a></li>
<li class="toc-entry toc-h3"><a href="#journals">Journals</a></li>
<li class="toc-entry toc-h3"><a href="#entry-logs">Entry logs</a></li>
<li class="toc-entry toc-h4"><a href="#log-device">Log device</a></li>
<li class="toc-entry toc-h3"><a href="#index-files">Index files</a></li>
<li class="toc-entry toc-h3"><a href="#ledger-cache">Ledger cache</a></li>
<li class="toc-entry toc-h4"><a href="#ledger-device">Ledger device</a></li>
<li class="toc-entry toc-h3"><a href="#data-flush">Data flush</a></li>
<li class="toc-entry toc-h3"><a href="#data-compaction">Data compaction</a></li>
<li class="toc-entry toc-h2"><a href="#zookeeper-metadata">ZooKeeper metadata</a></li>
<li class="toc-entry toc-h2"><a href="#ledger-manager">Ledger manager</a></li>
<li class="toc-entry toc-h4"><a href="#use-the-flat-ledger-manager-in-most-cases">Use the flat ledger manager in most cases</a></li>
<li class="toc-entry toc-h3"><a href="#flat-ledger-manager">Flat ledger manager</a></li>
<li class="toc-entry toc-h3"><a href="#hierarchical-ledger-manager">Hierarchical ledger manager</a></li>
</ul>
</div>

      
    </div>
  </div>
</div>



<div id="entry-popover-html" class="popover-template">
  <p>An entry is a sequence of bytes written to a BookKeeper ledger.</p>

</div>

<div id="ledger-popover-html" class="popover-template">
  <p>A ledger is a sequence of entries written to BookKeeper. Entries are written sequentially to ledgers and at most once, giving ledgers append-only semantics.</p>

</div>

<div id="bookie-popover-html" class="popover-template">
  <p>A bookie is an individial BookKeeper storage server.</p>

<p>Bookies store the content of ledgers and act as a distributed ensemble.</p>

</div>

<div id="striping-popover-html" class="popover-template">
  <p>Striping is the process of distributing BookKeeper ledgers to sub-groups of bookies rather than to all bookies in a BookKeeper ensemble. Striping is essential to ensuring fast performance.</p>

</div>

<div id="journal-popover-html" class="popover-template">
  <p>A journal file stores BookKeeper transaction logs.</p>

</div>


<script type="text/javascript">

tippy('#entry-popover', {
  html: '#entry-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#ledger-popover', {
  html: '#ledger-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#bookie-popover', {
  html: '#bookie-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#striping-popover', {
  html: '#striping-popover-html',
  arrow: true,
  animation: 'fade'
});

tippy('#journal-popover', {
  html: '#journal-popover-html',
  arrow: true,
  animation: 'fade'
});

</script>


    </main>

    <footer class="footer">
  <div class="container">
    <div class="content has-text-centered">
      <p>
        Copyright &copy; 2016 - 2017 <a href="https://www.apache.org/">The Apache Software Foundation</a>,<br /> licensed under the <a href="http://www.apache.org/licenses/LICENSE-2.0">Apache License, version 2.0</a>.
      </p>
    </div>
  </div>
</footer>

  </body>

  <script src="/bookkeeper/js/app.js"></script>

</html>
